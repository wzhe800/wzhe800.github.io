<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.3">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.3" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.0.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  
  <meta name="keywords" content="Hexo, NexT" />


<meta name="description" content="所学即所得">
<meta property="og:type" content="website">
<meta property="og:title" content="learningByDoing">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="learningByDoing">
<meta property="og:description" content="所学即所得">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="learningByDoing">
<meta name="twitter:description" content="所学即所得">






  <link rel="canonical" href="http://yoursite.com/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>
  <title>learningByDoing</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">learningByDoing</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-th"></i> <br />Categories</a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
        </li>
      

      
    </ul>
  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/17/spring/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="h#">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="learningByDoing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/17/spring/" itemprop="url">spring</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-17T00:00:00+08:00">2017-11-17</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/JavaWeb/" itemprop="url" rel="index"><span itemprop="name">JavaWeb</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/JavaWeb/SSM框架/" itemprop="url" rel="index"><span itemprop="name">SSM框架</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="框架搭建"><a href="#框架搭建" class="headerlink" title="框架搭建"></a>框架搭建</h1><ol>
<li>导包</li>
<li>创建对象</li>
<li>写配置文件（建议命名为applicationContext.xml放置到src下），写 <beans>标签并导入xsd约束</beans></li>
<li>注册对象到容器</li>
</ol>
<h1 id="IOC-amp-DI"><a href="#IOC-amp-DI" class="headerlink" title="IOC&amp;DI"></a>IOC&amp;DI</h1><h2 id="IOC-Inverse-Of-Control，控制反转"><a href="#IOC-Inverse-Of-Control，控制反转" class="headerlink" title="IOC:Inverse Of Control，控制反转"></a>IOC:Inverse Of Control，控制反转</h2><p>对象的创建以及依赖关系由开发人员自己完成并注入    反转成了        Spring完成对象的创建并注入依赖关系</p>
<h2 id="DI-Dependency-Injection-依赖注入"><a href="#DI-Dependency-Injection-依赖注入" class="headerlink" title="DI:Dependency Injection 依赖注入"></a>DI:Dependency Injection 依赖注入</h2><p>实现IOC需要DI作支持</p>
<p>注入方式：</p>
<ol>
<li>set方法</li>
<li>构造方法</li>
<li>字段</li>
</ol>
<p>注入类型：</p>
<ol>
<li>值类型（八大基本数据类型）</li>
<li>引用类型（依赖对象）</li>
</ol>
<h1 id="ApplicationContext-amp-BeanFactory"><a href="#ApplicationContext-amp-BeanFactory" class="headerlink" title="ApplicationContext&amp;BeanFactory"></a>ApplicationContext&amp;BeanFactory</h1><p>BeanFactory是spring的原始接口，实现功能较为单一。其接口实现类的容器的特点是每次在获得对象时才会创建对象。</p>
<p>ApplicationContext容器每次启动时就会创建配置中的所有对象，提供更多的功能。其加载配置文件有两个方法：</p>
<ol>
<li>从类路径加载：ClassPathXmlApplicationContext</li>
<li>从硬盘路径加载：FileSystemXmlApplicationContext</li>
</ol>
<p>因此在web开发中使用ApplicationContext，在资源匮乏的情况下使用BeanFactory</p>
<h1 id="配置详解"><a href="#配置详解" class="headerlink" title="配置详解"></a>配置详解</h1><h2 id="Bean元素"><a href="#Bean元素" class="headerlink" title="Bean元素"></a>Bean元素</h2><p>使用该元素描述需要Spring容器管理的对象</p>
<h3 id="空参构造对象"><a href="#空参构造对象" class="headerlink" title="空参构造对象"></a>空参构造对象</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	name属性：给被管理的对象起个名字，根据该名称获得对象，可使用特殊字符</span></span><br><span class="line"><span class="comment">	class属性：被管理对象的完整类名</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"domain.User"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="静态工厂（了解）"><a href="#静态工厂（了解）" class="headerlink" title="静态工厂（了解）"></a>静态工厂（了解）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//spring通过调用这个类的静态方法来创建</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> User <span class="title">createUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> User();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	调用UserFactory的createUser方法来创建user2对象，放入容器</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"user2"</span> <span class="attr">class</span>=<span class="string">"domain.UserFactory"</span> <span class="attr">factory-method</span>=<span class="string">"createUser"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="实例工厂（了解）"><a href="#实例工厂（了解）" class="headerlink" title="实例工厂（了解）"></a>实例工厂（了解）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//spring通过调用这个类的静态方法来创建</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> User <span class="title">createUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> User();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	调用UserFactory对象的createUser2方法来创建user3对象，放入容器</span></span><br><span class="line"><span class="comment">	与静态工厂的区别是：这个方法还要创建UserFactory对象。而静态工厂是直接调用UserFactory类的静态方法</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"userFactory"</span> <span class="attr">class</span>=<span class="string">"domain.UserFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"user3"</span> <span class="attr">factory-bean</span>=<span class="string">"userFactory"</span> <span class="attr">factory-method</span>=<span class="string">"createUser2"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="scope属性"><a href="#scope属性" class="headerlink" title="scope属性"></a>scope属性</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	singleton（默认）:单例对象。对象在容器中只会存在一个实例。</span></span><br><span class="line"><span class="comment">	prototype:多例原型。被标识为多例的对象，每次在获得时才会创建新的对象。action对象必须要配成prototype。</span></span><br><span class="line"><span class="comment">	request（了解）:web环境下，对象与request生命周期一致。</span></span><br><span class="line"><span class="comment">	session（了解）:web环境下，对象与session生命周期一致。</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"domain.User"</span> <span class="attr">scope</span>=<span class="string">"singleton"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="生命周期属性（了解）"><a href="#生命周期属性（了解）" class="headerlink" title="生命周期属性（了解）"></a>生命周期属性（了解）</h3><p>可配置一个方法作为生命周期初始化方法，spring会在对象创建后立即调用。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"domain.User"</span> <span class="attr">init-method</span>=<span class="string">"init"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>同时可配置一个方法作为生命周期销毁方法，spring容器会在关闭并销毁所有对象之前调用，做后处理工作。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"domain.User"</span> <span class="attr">destory-method</span>=<span class="string">"destory"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>bean中要有这两个方法。</p>
<h2 id="模块化配置"><a href="#模块化配置" class="headerlink" title="模块化配置"></a>模块化配置</h2><p>当容器中的对象太多，会很乱，因此引入模块化配置，可导入其它spring配置文件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	在struts2中是include file</span></span><br><span class="line"><span class="comment">	在hibernate中是mapping resource</span></span><br><span class="line"><span class="comment">	在spring中是import resource</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"domain/applicationContext.xml"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="单一属性注入"><a href="#单一属性注入" class="headerlink" title="单一属性注入"></a>单一属性注入</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//此为对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> Integer age;</span><br><span class="line">  <span class="keyword">private</span> Car car;</span><br><span class="line">  set与get</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> color;</span><br><span class="line">  set与get</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="set方法注入"><a href="#set方法注入" class="headerlink" title="set方法注入"></a>set方法注入</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"domain.User"</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		值类型注入：为user对象中名为name的属性注入tom作为值</span></span><br><span class="line"><span class="comment"> 	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"tom"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"domain.User"</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		对象类型注入：为user对象中名为car的属性注入下方的car对象</span></span><br><span class="line"><span class="comment"> 	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"car"</span> <span class="attr">ref</span>=<span class="string">"car"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"car"</span> <span class="attr">class</span>=<span class="string">"domain.Car"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"兰博基尼"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="构造函数方法注入"><a href="#构造函数方法注入" class="headerlink" title="构造函数方法注入"></a>构造函数方法注入</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"user2"</span> <span class="attr">class</span>=<span class="string">"domain.User"</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- 假设构造函数为public User(String name, Integer age, Car car) --&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- 因为spring不知道name和age和car在构造函数中是如何放置的，因此最好用index属性指明位置 --&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- 因为spring不知道构造函数参数的类型，因此要用type属性指明完整类名 --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"jerry"</span> <span class="attr">index</span>=<span class="string">"0"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"18"</span> <span class="attr">index</span>=<span class="string">"1"</span> <span class="attr">type</span>=<span class="string">"java.lang.Integer"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"car"</span> <span class="attr">ref</span>=<span class="string">"car"</span> <span class="attr">index</span>=<span class="string">"2"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"car"</span> <span class="attr">class</span>=<span class="string">"domain.Car"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"兰博基尼"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="p名称空间注入（了解、未学）"><a href="#p名称空间注入（了解、未学）" class="headerlink" title="p名称空间注入（了解、未学）"></a>p名称空间注入（了解、未学）</h3><h3 id="spel注入（了解、未学）"><a href="#spel注入（了解、未学）" class="headerlink" title="spel注入（了解、未学）"></a>spel注入（了解、未学）</h3><h2 id="集合属性注入"><a href="#集合属性注入" class="headerlink" title="集合属性注入"></a>集合属性注入</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//此为对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CollectionBean</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Object[] arr;</span><br><span class="line">  <span class="keyword">private</span> List list;</span><br><span class="line">  <span class="keyword">private</span> Map map;</span><br><span class="line">  <span class="keyword">private</span> Properties property;</span><br><span class="line">  get与set</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"cb"</span> <span class="attr">class</span>=<span class="string">"domain.CollectionBean"</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- 若arr或list中只准备注入一个对象/值，则直接使用ref/value即可 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"arr"</span> <span class="attr">value</span>=<span class="string">"tom"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- 否则如下注入数组 --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"arr"</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">      		<span class="tag">&lt;<span class="name">value</span>&gt;</span>value1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">          	<span class="tag">&lt;<span class="name">value</span>&gt;</span>value2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">          	<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"otherObject"</span> /&gt;</span></span><br><span class="line">      	<span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- 如下注入list --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">      		<span class="tag">&lt;<span class="name">value</span>&gt;</span>value3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">          	<span class="tag">&lt;<span class="name">value</span>&gt;</span>value4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">          	<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"otherObject"</span> /&gt;</span></span><br><span class="line">      	<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- 如下注入map --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">      		<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql:///crm"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">          	<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"car"</span> <span class="attr">value-ref</span>=<span class="string">"car"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">          	<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key-ref</span>=<span class="string">"user3"</span> <span class="attr">value-ref</span>=<span class="string">"user2"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- 如下注入properties --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prop"</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"userName"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">prop</span>&gt;</span> </span><br><span class="line">          	<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"password"</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="监听器"><a href="#监听器" class="headerlink" title="监听器"></a>监听器</h1><p>在web.xml中利用监听器元素，使applicationContext的生命周期与ServletContext生命周期一致，这样在发出请求拿到对象时，就不用每次都创建一个applicationContext容器。此容器在整个项目周期中应保持只有一个。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 指定加载spring配置文件的位置  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里的监听器就是servletContext的监听器。因此可以先获得servletContext对象，再从其域中取出applicationContext容器。getAttribute方法被spring封装到工具包中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ServletContext sc = ServletActionContext.getServletContext();</span><br><span class="line">WebApplicationContext ac = WebApplicationContextUtils.getWebApplicationContext(sc);</span><br><span class="line">CustomerService customerService = (CustomerService)ac.getBean(<span class="string">"customerService"</span>);</span><br></pre></td></tr></table></figure>
<h1 id="注解配置spring"><a href="#注解配置spring" class="headerlink" title="注解配置spring"></a>注解配置spring</h1><ol>
<li>导入context schema</li>
<li>开启使用注解代理配置文件</li>
<li>在类中使用注解</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在beans元素下加上context:component-scan子元素，会自动扫描识别domain包及其子包下的所有组件(类)的注解 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"domain"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&lt;bean name="user" class="domain.User"&gt;&lt;/bean&gt;</span></span><br><span class="line"><span class="meta">@Component</span>(<span class="string">"user"</span>)		<span class="comment">//变成了下面的三个可识别的注解，效果一样</span></span><br><span class="line"><span class="meta">@Service</span>(<span class="string">"user"</span>)	<span class="comment">//service层</span></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">"user"</span>)		<span class="comment">//web层</span></span><br><span class="line"><span class="meta">@Repository</span>(<span class="string">"user"</span>)		<span class="comment">//dao层   这里用Repository</span></span><br><span class="line"><span class="meta">@Scope</span>(scopeName=<span class="string">"prototype"</span>)   <span class="comment">//scope属性，不加默认为singleton</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"tom"</span>)		<span class="comment">//通过反射的Field赋值，破坏封装性，不推荐</span></span><br><span class="line">    <span class="keyword">private</span> String user_name;</span><br><span class="line">  </span><br><span class="line">  	<span class="meta">@Autowired</span>	<span class="comment">//自动装配成员对象，若容器匹配到多个类型一致的对象则无法选择具体注入哪一个对象，会报错</span></span><br><span class="line">  	<span class="meta">@Qualifier</span>(<span class="string">"car2"</span>)	<span class="comment">//指定名称封装成员对象,要与Autowired一起使用</span></span><br><span class="line">  	<span class="meta">@Resource</span>(name=<span class="string">"car2"</span>)	<span class="comment">//推荐只用Resource，直接指定 </span></span><br><span class="line">  	<span class="keyword">private</span> Car car;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUser_name</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> user_name;</span><br><span class="line">      &#125;</span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"tom"</span>)	<span class="comment">//通过set方法赋值</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser_name</span><span class="params">(String user_name)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.user_name = user_name;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  	&#125;</span><br><span class="line">	<span class="meta">@PostConstruct</span>	<span class="comment">//初始化方法，在构造后执行，不是spring注解</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"init"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@PreDestroy</span>		<span class="comment">//后处理方法，在销毁前执行，不是spring注解</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"destory"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="spring与junit整合"><a href="#spring与junit整合" class="headerlink" title="spring与junit整合"></a>spring与junit整合</h1><p>每次若在@Test方法下创建一个容器会很麻烦且占用内存，spring有专门的test包，junit也有专门指定测试环境的注解。如下整合测试类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试时自动创建容器，测试完会自动销毁</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="comment">//指定配置文件位置</span></span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Resource</span>(name=<span class="string">"user1"</span>)	<span class="comment">//将名为user1的对象注入到user属性中</span></span><br><span class="line">  <span class="keyword">private</span> User user;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    syso(user);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="spring中的aop思想"><a href="#spring中的aop思想" class="headerlink" title="spring中的aop思想"></a>spring中的aop思想</h1><p>spring中若代理对象有接口，则使用动态代理。若没有接口，则使用cglib代理。</p>
<h2 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h2><p>spring能够为容器中管理的对象生成动态代理对象。</p>
<p>若给service对象生成动态代理对象，则可以在动态代理对象中统一进行事务的处理。</p>
<p><strong>缺陷</strong>：<code>Proxy.newProxyInstance(classLoader,Interface[] arr, InvocationHandler handler)</code>被代理对象必须要实现接口才可使用动态代理</p>
<h2 id="cglib代理"><a href="#cglib代理" class="headerlink" title="cglib代理"></a>cglib代理</h2><p>可以对任何类生成代理。与动态代理不同，它对代理对象进行继承代理而不是接口代理。若目标对象被final修饰，则该类无法被cglib代理。</p>
<h2 id="aop名词解释"><a href="#aop名词解释" class="headerlink" title="aop名词解释"></a>aop名词解释</h2><ol>
<li>JoinPoint(连接点)：目标对象中，所有可以增强的方法</li>
<li>PointCut(切入点)：目标对象中，已经增强的方法</li>
<li>Advice(通知/增强)：要增强的代码。如开启事务与提交事务。</li>
<li>Target(目标对象)：被代理对象</li>
<li>Weaving(织入)：将通知应用到连接点形成切入点</li>
<li>Proxy(代理)： 代理对象</li>
<li>aspect(切面)：切入点+通知</li>
</ol>
<h2 id="aop准备工作"><a href="#aop准备工作" class="headerlink" title="aop准备工作"></a>aop准备工作</h2><ol>
<li><p>导包</p>
</li>
<li><p>准备目标对象（ServiceImpl）</p>
</li>
<li><p>准备通知</p>
<ol>
<li><p>前置通知：目标方法运行前调用</p>
</li>
<li><p>后置通知1：目标方法运行后调用，若出现异常不会调用</p>
</li>
<li><p>后置通知2：目标方法运行后调用，若出现异常仍会调用</p>
</li>
<li><p>环绕通知：目标方法运行前后都会调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//环绕通知</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"beforeAround"</span>);</span><br><span class="line">		Object proceed = pjp.proceed();   <span class="comment">//调用目标方法</span></span><br><span class="line">		System.out.println(<span class="string">"afterAround"</span>);</span><br><span class="line">		<span class="keyword">return</span> proceed;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>异常拦截通知：若出现异常则会调用</p>
</li>
</ol>
</li>
<li><p>利用配置将通知织入目标对象</p>
<ol>
<li><p>导入aop约束</p>
</li>
<li><p>配置目标对象</p>
</li>
<li><p>配置通知对象</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"myadvice"</span> <span class="attr">class</span>=<span class="string">"advice"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置织入</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置切入点</span></span><br><span class="line"><span class="comment">		第一个*代表返回任意类型</span></span><br><span class="line"><span class="comment">		*Action1代表test包下任意以Action1结尾的类</span></span><br><span class="line"><span class="comment">		*(..)代表含任意参数的任意方法	*为方法 (..)为参数</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* test.*Action1.*(..))"</span> <span class="attr">id</span>=<span class="string">"pc"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"myAdvice"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"before"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pc"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"afterReturning"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pc"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"after"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pc"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"around"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pc"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"afterException"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pc"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
<h1 id="spring整合jdbc"><a href="#spring整合jdbc" class="headerlink" title="spring整合jdbc"></a>spring整合jdbc</h1><h2 id="jdbcTemplate（模板对象）"><a href="#jdbcTemplate（模板对象）" class="headerlink" title="jdbcTemplate（模板对象）"></a>jdbcTemplate（模板对象）</h2><p>spring提供了可操作数据库的对象，封装了jdbc技术，与DBUtils中的QueryRunner非常相似。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建连接池</span></span><br><span class="line">ComboPooledDataSource dataSource = <span class="keyword">new</span> ComboPooledDataSource();</span><br><span class="line">dataSource.setDriverClass(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">dataSource.setJdbcUrl(<span class="string">"jdbc:mysql:///cst"</span>);</span><br><span class="line">dataSource.setUser(<span class="string">"root"</span>);</span><br><span class="line">dataSource.setPassword(<span class="string">"WZhe941127"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建jdbc模板对象</span></span><br><span class="line">JdbcTemplate jt = <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line"></span><br><span class="line">String sql = <span class="string">"insert into test values('bbb', 'aaa')"</span>;</span><br><span class="line"></span><br><span class="line">jt.update(sql);</span><br></pre></td></tr></table></figure>
<h2 id="实现dao的API"><a href="#实现dao的API" class="headerlink" title="实现dao的API"></a>实现dao的API</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//增删改用update</span></span><br><span class="line"><span class="comment">//查找用query</span></span><br><span class="line"><span class="comment">//主要是查找，当查找的结果不是基本数据类型时，要自己手动完成从ResultSet到对象类型的封装。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoDaoImpl</span> <span class="keyword">implements</span> <span class="title">DemoDao</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> JdbcTemplate jt;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(DemoBean demo)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		String sql = <span class="string">"insert into testTable values(?,?)"</span>;</span><br><span class="line">		jt.update(sql,demo.getId(),demo.getName());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		String sql = <span class="string">"delete from testTable where id =?"</span>;</span><br><span class="line">		jt.update(sql, id);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(DemoBean demo)</span> </span>&#123;</span><br><span class="line">		String sql=<span class="string">"update testTable set id=? ,name=?"</span>;</span><br><span class="line">		jt.update(sql, demo.getId(), demo.getName());</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> DemoBean <span class="title">getByiD</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		String sql =<span class="string">"select * from testTable where id=?"</span>;</span><br><span class="line">		<span class="keyword">return</span> jt.queryForObject(sql, <span class="keyword">new</span> RowMapper&lt;DemoBean&gt;()&#123;</span><br><span class="line"></span><br><span class="line">			<span class="function"><span class="keyword">public</span> DemoBean <span class="title">mapRow</span><span class="params">(ResultSet rs, <span class="keyword">int</span> arg1)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">				DemoBean demo = <span class="keyword">new</span> DemoBean();</span><br><span class="line">				demo.setId(rs.getInt(<span class="string">"id"</span>));</span><br><span class="line">				demo.setName(rs.getString(<span class="string">"name"</span>));</span><br><span class="line">				<span class="keyword">return</span> demo;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;, id);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">totalCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		String sql = <span class="string">"select count(*) from testTable"</span>;</span><br><span class="line">		<span class="keyword">return</span> jt.queryForObject(sql, Integer.class);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;DemoBean&gt; <span class="title">getAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		String sql = <span class="string">"select * from testTable"</span>;</span><br><span class="line">		<span class="keyword">return</span> jt.query(sql, <span class="keyword">new</span> RowMapper&lt;DemoBean&gt;()&#123;</span><br><span class="line"></span><br><span class="line">			<span class="function"><span class="keyword">public</span> DemoBean <span class="title">mapRow</span><span class="params">(ResultSet rs, <span class="keyword">int</span> arg1)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">				DemoBean demo = <span class="keyword">new</span> DemoBean();</span><br><span class="line">				demo.setId(rs.getInt(<span class="string">"id"</span>));</span><br><span class="line">				demo.setName(rs.getString(<span class="string">"name"</span>));</span><br><span class="line">				<span class="keyword">return</span> demo;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="将连接池、JDBC模板、dao配置到spring"><a href="#将连接池、JDBC模板、dao配置到spring" class="headerlink" title="将连接池、JDBC模板、dao配置到spring"></a>将连接池、JDBC模板、dao配置到spring</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql:///test"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"WZhe941127"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"jdbcTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"demoDao"</span> <span class="attr">class</span>=<span class="string">"test.DemoDaoImpl"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jt"</span> <span class="attr">ref</span>=<span class="string">"jdbcTemplate"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：连接池的类名不要弄错。若要自动补全，不能datasource然后补全，不然会找不到这个类。要combopooled再自动补全，就找到这个类了。property的name必须要与类中的一致，并不是起标识作用而能乱设的。</p>
<h2 id="JdbcDaoSupport"><a href="#JdbcDaoSupport" class="headerlink" title="JdbcDaoSupport"></a>JdbcDaoSupport</h2><p>这个类中封装了jdbcTemplate，根据连接池来创建jdbcTemplate。DaoImpl若继承了它，便不用手动准备jdbcTemplate,可以直接通过super.getJdbcTemplate()来获得。只要准备一个连接池就好了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//之前所有的jt都变成了实时的super.getJdbcTemplate()</span></span><br><span class="line"><span class="comment">//不用设置dataSource属性，因为JdbcDaoSupport类中已经有了，只要记得在配置文件中设置dataSource属性即可。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoDaoImpl</span> <span class="keyword">extends</span> <span class="title">JdbcDaoSupport</span> <span class="keyword">implements</span> <span class="title">DemoDao</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(DemoBean demo)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		String sql = <span class="string">"insert into testTable values(?,?)"</span>;</span><br><span class="line">		<span class="keyword">super</span>.getJdbcTemplate().update(sql,demo.getId(),demo.getName());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		String sql = <span class="string">"delete from testTable where id =?"</span>;</span><br><span class="line">		<span class="keyword">super</span>.getJdbcTemplate().update(sql, id);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(DemoBean demo)</span> </span>&#123;</span><br><span class="line">		String sql=<span class="string">"update testTable set id=? ,name=?"</span>;</span><br><span class="line">		<span class="keyword">super</span>.getJdbcTemplate().update(sql, demo.getId(), demo.getName());</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> DemoBean <span class="title">getByiD</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		String sql =<span class="string">"select * from testTable where id=?"</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">super</span>.getJdbcTemplate().queryForObject(sql, <span class="keyword">new</span> RowMapper&lt;DemoBean&gt;()&#123;</span><br><span class="line"></span><br><span class="line">			<span class="function"><span class="keyword">public</span> DemoBean <span class="title">mapRow</span><span class="params">(ResultSet rs, <span class="keyword">int</span> arg1)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">				DemoBean demo = <span class="keyword">new</span> DemoBean();</span><br><span class="line">				demo.setId(rs.getInt(<span class="string">"id"</span>));</span><br><span class="line">				demo.setName(rs.getString(<span class="string">"name"</span>));</span><br><span class="line">				<span class="keyword">return</span> demo;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;, id);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">totalCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		String sql = <span class="string">"select count(*) from testTable"</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">super</span>.getJdbcTemplate().queryForObject(sql, Integer.class);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;DemoBean&gt; <span class="title">getAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		String sql = <span class="string">"select * from testTable"</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">super</span>.getJdbcTemplate().query(sql, <span class="keyword">new</span> RowMapper&lt;DemoBean&gt;()&#123;</span><br><span class="line"></span><br><span class="line">			<span class="function"><span class="keyword">public</span> DemoBean <span class="title">mapRow</span><span class="params">(ResultSet rs, <span class="keyword">int</span> arg1)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">				DemoBean demo = <span class="keyword">new</span> DemoBean();</span><br><span class="line">				demo.setId(rs.getInt(<span class="string">"id"</span>));</span><br><span class="line">				demo.setName(rs.getString(<span class="string">"name"</span>));</span><br><span class="line">				<span class="keyword">return</span> demo;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="读取properties文件"><a href="#读取properties文件" class="headerlink" title="读取properties文件"></a>读取properties文件</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 以读取数据库配置为例 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 指定properties文件位置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:db.properties"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 取值用$符 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driverClass&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.jdbcUrl&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.user&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="spring事务管理"><a href="#spring事务管理" class="headerlink" title="spring事务管理"></a>spring事务管理</h1><p>Spring内部封装了事务管理的代码。针对不同的操作数据库的框架，spring提供了一个统一的PlatformTransactionManager接口。在接口下有三个实现类：</p>
<ol>
<li>DataSourceTransactionManager</li>
<li>HibernateTransactionManager</li>
<li>Mybatis…</li>
</ol>
<h2 id="可选事务属性"><a href="#可选事务属性" class="headerlink" title="可选事务属性"></a>可选事务属性</h2><ol>
<li>隔离级别<ol>
<li>读未提交——1</li>
<li>读已提交——2</li>
<li>可重复读——4</li>
<li>串行化——8</li>
</ol>
</li>
<li>是否只读<ol>
<li>true——只读</li>
<li>False——不只读（默认）</li>
</ol>
</li>
<li>传播行为：业务（Service）方法之间调用时，事务应该如何处理，有七个值，只使用REQUIRED（默认）:支持当前事务，若不存在，就新建一个。如A方法调用B方法时，若A已经开启了事务，则B就用A的事务。若A没开启事务，则B开启事务。</li>
</ol>
<h2 id="管理事务方式"><a href="#管理事务方式" class="headerlink" title="管理事务方式"></a>管理事务方式</h2><h3 id="编码式（了解）"><a href="#编码式（了解）" class="headerlink" title="编码式（了解）"></a>编码式（了解）</h3><h3 id="xml配置（aop）"><a href="#xml配置（aop）" class="headerlink" title="xml配置（aop）"></a>xml配置（aop）</h3><ol>
<li><p>导包</p>
</li>
<li><p>导入新的约束（tx）</p>
</li>
<li><p>配置事务通知</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 事务核心管理器,封装了所有事务操作. 依赖于连接池 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 事务模板对象,依赖于事务核心管理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"transactionTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.transaction.support.TransactionTemplate"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"transactionManager"</span> <span class="attr">ref</span>=<span class="string">"transactionManager"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 要在业务层service类中添加transactionTemplate属性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"service.impl.AccountServiceImpl"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"accountDao"</span> <span class="attr">ref</span>=<span class="string">"accountDao"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"tt"</span> <span class="attr">ref</span>=<span class="string">"transactionTemplate"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置事务通知 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"advice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 八大常用方法通配符 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"save*"</span> <span class="attr">isolation</span>=<span class="string">"REPEATABLE_READ"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"persist*"</span> <span class="attr">isolation</span>=<span class="string">"REPEATABLE_READ"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"delete*"</span> <span class="attr">isolation</span>=<span class="string">"REPEATABLE_READ"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"remove*"</span> <span class="attr">isolation</span>=<span class="string">"REPEATABLE_READ"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"update*"</span> <span class="attr">isolation</span>=<span class="string">"REPEATABLE_READ"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"modify*"</span> <span class="attr">isolation</span>=<span class="string">"REPEATABLE_READ"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"get*"</span> <span class="attr">isolation</span>=<span class="string">"REPEATABLE_READ"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"find*"</span> <span class="attr">isolation</span>=<span class="string">"REPEATABLE_READ"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"transfer"</span> <span class="attr">isolation</span>=<span class="string">"REPEATABLE_READ"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span> <span class="attr">proxy-target-class</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* service.impl.*ServiceImpl.*(..))"</span> <span class="attr">id</span>=<span class="string">"txpc"</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 指定切面与切入点 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"advice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"txpc"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="注解配置（aop）"><a href="#注解配置（aop）" class="headerlink" title="注解配置（aop）"></a>注解配置（aop）</h3><ol>
<li><p>导包</p>
</li>
<li><p>导入新的约束（tx）</p>
</li>
<li><p>开启使用注解管理事务</p>
<p><code>&lt;tx:annotaion-driven /&gt;</code></p>
</li>
<li><p>在业务层使用注解</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在类名上使用事务注解，类中的所有方法默认采用这种方法管理事务</span></span><br><span class="line"><span class="meta">@Transactional</span>(isolation=Isolation.REPEATABLE_READ, propagation=Propagation.REQUIRED, readOnly=<span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> AccountDaoImpl accountDao;</span><br><span class="line">	<span class="keyword">private</span> TransactionTemplate tt;</span><br><span class="line">  </span><br><span class="line">  	<span class="function"><span class="keyword">public</span> AccountDaoImpl <span class="title">getAccountDao</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> accountDao;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAccountDao</span><span class="params">(AccountDaoImpl accountDao)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.accountDao = accountDao;</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">  	<span class="comment">//在指定方法上使用事务注解，重写类名上的注解</span></span><br><span class="line">	<span class="meta">@Transactional</span>(isolation=Isolation.REPEATABLE_READ, propagation=Propagation.REQUIRED, readOnly=<span class="keyword">false</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(Integer from, Integer to, Double money)</span> </span>&#123;</span><br><span class="line">		accountDao.decreaseMoney(from, money);</span><br><span class="line">		<span class="keyword">int</span> i = <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">		accountDao.increaseMoney(to, money);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> TransactionTemplate <span class="title">getTt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> tt;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTt</span><span class="params">(TransactionTemplate tt)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.tt = tt;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/17/SSM整合/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="h#">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="learningByDoing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/17/SSM整合/" itemprop="url">SSM整合</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-17T00:00:00+08:00">2017-11-17</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/JavaWeb/" itemprop="url" rel="index"><span itemprop="name">JavaWeb</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/JavaWeb/SSM框架/" itemprop="url" rel="index"><span itemprop="name">SSM框架</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Mybatis"><a href="#Mybatis" class="headerlink" title="Mybatis"></a>Mybatis</h1><ol>
<li>sqlMapConfig.xml<ol>
<li>别名</li>
</ol>
</li>
<li>cn.dao配置Mapper</li>
<li>cn.pojo配置pojo</li>
</ol>
<h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><ol>
<li>applicationContext.xml<ol>
<li>开启注解赋值</li>
<li>开启类扫描</li>
<li>数据源连接池</li>
<li>SqlSessionFactory</li>
<li>Mapper动态代理扫描开发</li>
</ol>
</li>
<li>web.xml中配置spring容器随服务器开启而加载(listener)，并指定配置文件位置</li>
</ol>
<h1 id="Springmvc"><a href="#Springmvc" class="headerlink" title="Springmvc"></a>Springmvc</h1><ol>
<li>springmvc.xml<ol>
<li>开启类扫描</li>
<li>三大组件</li>
</ol>
</li>
<li>web.xml中配置前端控制器(servlet),并指定配置文件位置</li>
</ol>
<h1 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h1><p>db.properties与log4j.properties</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/17/mybatis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="h#">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="learningByDoing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/17/mybatis/" itemprop="url">mybatis</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-17T00:00:00+08:00">2017-11-17</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/JavaWeb/" itemprop="url" rel="index"><span itemprop="name">JavaWeb</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/JavaWeb/SSM框架/" itemprop="url" rel="index"><span itemprop="name">SSM框架</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="mybatis架构"><a href="#mybatis架构" class="headerlink" title="mybatis架构"></a>mybatis架构</h1><ol>
<li>核心配置文件：SqlMapConfig.xml</li>
<li>数据库映射文件：MapperN.xml</li>
<li>由xml文件产生SqlSessionFactory</li>
<li>SqlSessionFactory产生SqlSession</li>
<li>调用SqlSession中的Executor</li>
<li>调用Executor中的MappedStatement存储sql语句的各字段成分</li>
<li>再返回来由Executor执行</li>
</ol>
<p>5-7是底层</p>
<h1 id="框架搭建"><a href="#框架搭建" class="headerlink" title="框架搭建"></a>框架搭建</h1><ol>
<li><p>导包</p>
</li>
<li><p>创建SqlMapConfig.xml并赋予dtd约束</p>
</li>
<li><p>创建log4j.properties</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Global logging configuration</span><br><span class="line">log4j.rootLogger=DEBUG, stdout</span><br><span class="line"># Console output...</span><br><span class="line">log4j.appender.stdout=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.stdout.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.stdout.layout.ConversionPattern=%5p [%t] - %m%n</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建mapper包，里面写动态代理实现Dao层的Mapper接口与对应的Mapper.xml，赋予dtd约束并告知SqlMapConfig.xml，注意两者的前缀要一致。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 指定Mapper.xml的包名</span></span><br><span class="line"><span class="comment">	   将各个pojo的Mapper.xml放在mapper包下，mybatis会自动注册包下的所有mapper接口，并将包下名称前缀相同的mapper接口与xml关联在一起。如UserMapper.java与UserMapper.xml</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"mapper"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="基本代码"><a href="#基本代码" class="headerlink" title="基本代码"></a>基本代码</h1></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//读取配置文件</span></span><br><span class="line">String resource = <span class="string">"classpath:SqlMapConfig.xml"</span>;</span><br><span class="line">InputStream in = Resources.getResourceAsStream(resource);</span><br><span class="line"></span><br><span class="line"><span class="comment">//SqlSessionFactoryBuilder   build   sqlSessionFactory</span></span><br><span class="line">SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line"></span><br><span class="line"><span class="comment">//SqlSessionFactory产生SqlSession</span></span><br><span class="line">SqlSession session = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line"><span class="comment">//SqlSession与数据库交互</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//手动提交事务</span></span><br><span class="line">session.commit();</span><br></pre></td></tr></table></figure>
<h1 id="数据库交互代码"><a href="#数据库交互代码" class="headerlink" title="数据库交互代码"></a>数据库交互代码</h1><h2 id="查询（单个）（底层）"><a href="#查询（单个）（底层）" class="headerlink" title="查询（单个）（底层）"></a>查询（单个）（底层）</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User user = session.selectOne(<span class="string">"test.getUserById"</span>, <span class="number">1</span>);</span><br><span class="line"><span class="comment">// 第一个参数是User.xml的statement的id，第二个参数是执行sql需要的参数；</span></span><br></pre></td></tr></table></figure>
<p>Mapper.xml配置如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"test"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserById"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span> <span class="attr">resultType</span>=<span class="string">"pojo.User"</span>&gt;</span></span><br><span class="line">      	<span class="comment">&lt;!-- #&#123;v&#125;为占位符？ 其中，大括号内可以为任意值，不一定是v--&gt;</span></span><br><span class="line">		select * from user where id = #&#123;v&#125;		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="查询（多个）（底层）"><a href="#查询（多个）（底层）" class="headerlink" title="查询（多个）（底层）"></a>查询（多个）（底层）</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Object&gt; list = session.selectList(<span class="string">"test.getUserByName"</span>, <span class="string">"王五"</span>);</span><br></pre></td></tr></table></figure>
<p>Mapper.xml配置如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注意：虽然返回的是List,但是resultType还是单个User --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 占位符是#&#123;..&#125;</span></span><br><span class="line"><span class="comment">	 而字符串拼接是'$&#123;value&#125;'，且大括号里面必须是value</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserByName"</span> <span class="attr">parameterType</span>=<span class="string">"String"</span> <span class="attr">resultType</span>=<span class="string">"pojo.User"</span>&gt;</span></span><br><span class="line">		select * from user where username like '%$&#123;value&#125;%'		</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Mapper.xml还可如下配置：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用#&#123;..&#125;来进行字符串拼接 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserByName"</span> <span class="attr">parameterType</span>=<span class="string">"String"</span> <span class="attr">resultType</span>=<span class="string">"pojo.User"</span>&gt;</span></span><br><span class="line">		select * from user where username like "%"#&#123;suibian&#125;"%"	</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="增（底层）"><a href="#增（底层）" class="headerlink" title="增（底层）"></a>增（底层）</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">session.insert(<span class="string">"test.insertUser"</span>, user);</span><br><span class="line"></span><br><span class="line"><span class="comment">//插入后自动返回相应id到user中</span></span><br><span class="line">syso(user.getId())</span><br></pre></td></tr></table></figure>
<p>Mapper.xml配置如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertUser"</span> <span class="attr">parameterType</span>=<span class="string">"pojo.User"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用selectKey元素，可以在插入后返回数据库中相应的某字段到user中 </span></span><br><span class="line"><span class="comment">		keyProperty为属性值</span></span><br><span class="line"><span class="comment">		resultType为返回类型</span></span><br><span class="line"><span class="comment">		order指在mysql中自动生成的id，是在其它字段插入完成后再自动生成</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span> <span class="attr">resultType</span>=<span class="string">"Integer"</span> <span class="attr">order</span>=<span class="string">"AFTER"</span>&gt;</span></span><br><span class="line">			select LAST_INSERT_ID()</span><br><span class="line">	<span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">		insert into user(username, sex, birthday, address) values(#&#123;username&#125;, #&#123;sex&#125;, #&#123;birthday&#125;, #&#123;address&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="删（底层）"><a href="#删（底层）" class="headerlink" title="删（底层）"></a>删（底层）</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.delete(<span class="string">"test.deleteUserById"</span>, <span class="number">27</span>);</span><br></pre></td></tr></table></figure>
<p>Mapper.xml配置如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteUserById"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span>&gt;</span></span><br><span class="line">		delete from user where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="改（底层）"><a href="#改（底层）" class="headerlink" title="改（底层）"></a>改（底层）</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.update(<span class="string">"test.updateUserById"</span>, user);</span><br></pre></td></tr></table></figure>
<p>Mapper.xml配置如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateUserById"</span> <span class="attr">parameterType</span>=<span class="string">"pojo.User"</span>&gt;</span></span><br><span class="line">		update user set username=#&#123;username&#125;, sex=#&#123;sex&#125;, birthday=#&#123;birthday&#125;, address=#&#123;address&#125; where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="mybatis与hibernate的不同"><a href="#mybatis与hibernate的不同" class="headerlink" title="mybatis与hibernate的不同"></a>mybatis与hibernate的不同</h1><ol>
<li>mybatis不完全是ORM框架，因为它要自己写SQL语句</li>
<li>mybatis比较简单，但无法做到数据库无关性，即没有数据库方言选项，一旦从mysql变成了oracle,它的sql语句就要变化。</li>
<li>mybatis适合对关系数据模型要求不高的软件开发</li>
</ol>
<h1 id="Dao层动态代理开发"><a href="#Dao层动态代理开发" class="headerlink" title="Dao层动态代理开发"></a>Dao层动态代理开发</h1><h2 id="Mapper接口"><a href="#Mapper接口" class="headerlink" title="Mapper接口"></a>Mapper接口</h2><p>只写一个接口，取代以前Dao和DaoImpl</p>
<p>遵循四个原则：</p>
<ol>
<li><p>Mapper.xml的命名空间是此接口的完整类名</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"mapper.UserMapper"</span>&gt;</span><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br><span class="line">这样，接口的实现类在执行方法时就会到这里来寻找对应的操作。</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法名与Mapper.xml中操作的id保持一致</p>
</li>
<li><p>方法的返回值与Mapper.xml中操作的resultType保持一致</p>
</li>
<li><p>方法的入参要与Mapper.xml中操作的parameterType保持一致</p>
</li>
</ol>
<p><strong>注意：</strong>SqlSession执行selectOne还是selectList，它会自行根据方法的返回值进行判断。</p>
<h2 id="dao层实现"><a href="#dao层实现" class="headerlink" title="dao层实现"></a>dao层实现</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UserMapper mapper = session.getMapper(UserMapper.class);</span><br><span class="line">User user = mapper.getUserById(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<h2 id="具体步骤"><a href="#具体步骤" class="headerlink" title="具体步骤"></a>具体步骤</h2><ol>
<li>session拿已有的接口创建Mapper实现类</li>
<li>mapper实现类调用特定方法，通过sqlmap中的namespace找到对应配置文件</li>
<li>执行与方法名相同的操作</li>
</ol>
<h1 id="核心配置-SqlMapConfig-xml-属性"><a href="#核心配置-SqlMapConfig-xml-属性" class="headerlink" title="核心配置(SqlMapConfig.xml)属性"></a>核心配置(SqlMapConfig.xml)属性</h1><p><strong>注意：</strong>以下属性为元素的先后顺序</p>
<h2 id="properties"><a href="#properties" class="headerlink" title="properties"></a>properties</h2><p>读取properties配置文件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"log4j.properties"</span>&gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="typeAliases"><a href="#typeAliases" class="headerlink" title="typeAliases"></a>typeAliases</h2><p>设置配置文件（包括SqlMapConfig.xml与sqlmap中的User.xml）中类型的别名</p>
<h3 id="单个类型设置"><a href="#单个类型设置" class="headerlink" title="单个类型设置"></a>单个类型设置</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">"pojo.User"</span> <span class="attr">alias</span>=<span class="string">"User"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样的话，一个类型就要一个元素，因此推荐下面的设置</p>
<h3 id="包设置"><a href="#包设置" class="headerlink" title="包设置"></a>包设置</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 只指定pojo包，则其中所有的pojo都会被扫描到，且其别名与类名相同</span></span><br><span class="line"><span class="comment">	 如User对应的别名是User与user</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"pojo"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="mappers"><a href="#mappers" class="headerlink" title="mappers"></a>mappers</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 指定Mapper.xml的包名</span></span><br><span class="line"><span class="comment">	   将各个pojo的Mapper.xml放在mapper包下，mybatis会自动注册包下的所有mapper接口，并将包下名称前缀相同的mapper接口与xml关联在一起。如UserMapper.java与UserMapper.xml</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"mapper"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="输入参数映射之POJO包装类"><a href="#输入参数映射之POJO包装类" class="headerlink" title="输入参数映射之POJO包装类"></a>输入参数映射之POJO包装类</h1><p>假设User对象同时是某对象（如QueryVo）的成员变量，若以QueryVo对象为输入参数，则相关Mapper.xml中配置如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserByQueryVo"</span> <span class="attr">parameterType</span>=<span class="string">"pojo.QueryVo"</span> <span class="attr">resultType</span>=<span class="string">"pojo.User"</span>&gt;</span></span><br><span class="line">	select * from user where username like "%"#&#123;user.username&#125;"%"	</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>同时在接口中要有getUserByQueryVo对应的方法。</p>
<h1 id="输出参数映射之resultMap"><a href="#输出参数映射之resultMap" class="headerlink" title="输出参数映射之resultMap"></a>输出参数映射之resultMap</h1><p>若pojo的属性名称与mysql的字段名称不一样，可以通过resultMap将字段名和属性名作一个对应关系，将查询结果映射为复杂类型的pojo。</p>
<p>在Mapper.xml中如下配置</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- select元素中的resultMap属性值要与resultMap元素的id值相同</span></span><br><span class="line"><span class="comment">	type指定pojo</span></span><br><span class="line"><span class="comment">	result元素用来指名映射，即从数据库中获得的user_id字段要放到Order类的userId属性中去</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"order"</span> <span class="attr">type</span>=<span class="string">"pojo.Order"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userId"</span> <span class="attr">column</span>=<span class="string">"user_id"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"orderList"</span> <span class="attr">resultMap</span>=<span class="string">"order"</span>&gt;</span></span><br><span class="line">	select * from orders</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="动态sql"><a href="#动态sql" class="headerlink" title="动态sql"></a>动态sql</h1><p>设定QueryVo下有可迭代属性，如</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Integer[] idarray;</span><br><span class="line"><span class="keyword">private</span> List&lt;Integer&gt; idlist;</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserByIds"</span> <span class="attr">parameterType</span>=<span class="string">"QueryVo"</span> <span class="attr">resultType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">  select * from user</span><br><span class="line">  <span class="comment">&lt;!-- where可以忽略where内部的第一个放在语句前的and --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    id in</span><br><span class="line">  <span class="comment">&lt;!-- 使idlist中提取出来的123变成(1,2,3) --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"idlist"</span> <span class="attr">item</span>=<span class="string">"id"</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- if标签必须要有test属性 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"id &gt;=10"</span>&gt;</span></span><br><span class="line">		#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>若输入参数不为QueryVo，而是直接将集合或者数组放入，则parameterType应为Integer, collection应固定为list或者array，否则会报错。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserByIds"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span> <span class="attr">resultType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">		select * from user</span><br><span class="line">			<span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">				id in</span><br><span class="line">				<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"id"</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">				#&#123;id&#125;</span><br><span class="line">				<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="一对一"><a href="#一对一" class="headerlink" title="一对一"></a>一对一</h1><p>一对一的情况即一个pojo中对应另一个pojo对象，此处以Order对应一个User为例</p>
<p>Mapper.xml配置如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- resultMap中，主键元素，即id元素可以不进行映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"orders"</span> <span class="attr">type</span>=<span class="string">"pojo.Order"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;id property="id" column="id"/&gt; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userId"</span> <span class="attr">column</span>=<span class="string">"user_id"</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 一对一标签association，对象属性的javaType不可以省略 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"user"</span> <span class="attr">javaType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;id property="id" column="id"/&gt; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getOrderList"</span> <span class="attr">resultMap</span>=<span class="string">"orders"</span>&gt;</span></span><br><span class="line">  select o.id, o.user_id, o.number, o.createtime, o.note, u.username from orders o left join user u on o.user_id = u.id</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h1><p>一对多的情况即一个pojo中对应另一个pojo的集合，此处以User对应多个Order为例</p>
<p>Mapper.xml配置如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"User"</span> <span class="attr">id</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 同样，主键元素可以不映射 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 一对多标签collection，javaType代表集合类型，ofType代表集合泛型 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"orders"</span> <span class="attr">javaType</span>=<span class="string">"List"</span> <span class="attr">ofType</span>=<span class="string">"Order"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"number"</span> <span class="attr">column</span>=<span class="string">"number"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserById"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span> <span class="attr">resultMap</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">  select u.id, u.username, u.birthday, u.address, u.sex, o.number from user u left join orders o on o.user_id = u.id</span><br><span class="line">  where</span><br><span class="line">  u.id = #&#123;id&#125;		</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="mybatis整合spring"><a href="#mybatis整合spring" class="headerlink" title="mybatis整合spring"></a>mybatis整合spring</h1><h2 id="整合思路"><a href="#整合思路" class="headerlink" title="整合思路"></a>整合思路</h2><p>1、SqlSessionFactory对象应该放到spring容器中作为单例存在。</p>
<p>2、传统dao的开发方式中，应该从spring容器中获得sqlsession对象。</p>
<p>3、Mapper代理形式中，应该从spring容器中直接获得mapper的代理对象。</p>
<p>4、数据库的连接以及数据库连接池事务管理都交给spring容器来完成。</p>
<h2 id="原始dao开发"><a href="#原始dao开发" class="headerlink" title="原始dao开发"></a>原始dao开发</h2><p>applicationContext.xml中配置数据源连接池、sqlSessionFactory，并将sqlSessionFactory赋予dao实现类。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置数据源连接池 --&gt;</span>	 </span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:db.properties"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.apache.commons.dbcp.BasicDataSource"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">destroy-method</span>=<span class="string">"close"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxActive"</span> <span class="attr">value</span>=<span class="string">"10"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdle"</span> <span class="attr">value</span>=<span class="string">"5"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置SqlSessionFactory --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:SqlMapConfig.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置dao层 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDao"</span> <span class="attr">class</span>=<span class="string">"dao.UserDaoImpl"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sqlSessionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>dao实现类继承SqlSessionDaoSupport类，便能直接得到sqlSession</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">extends</span> <span class="title">SqlSessionDaoSupport</span> <span class="keyword">implements</span> <span class="title">UserDao</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getUserById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">     	SqlSession sqlSession = <span class="keyword">this</span>.getSqlSession();</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="mapper动态代理开发"><a href="#mapper动态代理开发" class="headerlink" title="mapper动态代理开发"></a>mapper动态代理开发</h2><p>从代码上来看</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SqlSession sqlSession = sqlSessionFactory.openSession();	</span><br><span class="line">UserMapper mapper = sqlSession.getMapper(UserMapper.class);</span><br></pre></td></tr></table></figure>
<p>mapper的获取方式是：mybatis-spring就会用MapperFactoryBean即Mapper工厂来生成相应的mapper。而生成相应的mapper需要两个条件，一是sqlSessionFactory，用来生成sqlSession；二是Mapper接口用来指定Mapper的类型。配置如下</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置userMapper --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userMapper"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperFactoryBean"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sqlSessionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapperInterface"</span> <span class="attr">value</span>=<span class="string">"mapper.UserMapper"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其实就是用配置来封装了上面的两行代码。这样便可直接通过<code>getBean(&quot;userMapper&quot;)来获取到Mapper</code></p>
<h3 id="动态代理扫描开发"><a href="#动态代理扫描开发" class="headerlink" title="动态代理扫描开发"></a>动态代理扫描开发</h3><p>若一个业务一个mapper接口，则上面的配置就会有许多冗余。mybatis-spring提供MapperScannerConfigurer类，可以用来扫描指定的基本包下的所有mapper接口，并且不用有id，因为它是在基本包中查找。不用在其中配置SqlSessionFactory，它会自动在容器中找到。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Mapper动态代理扫描开发 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 扫描mapper基本包下的所有mapper接口 --&gt;</span>	</span><br><span class="line">  	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"mappper"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>但这种情况的Dao层，不能用名称来获取Bean，而是用class。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test6</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  ApplicationContext ac =<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">  <span class="comment">//spring获得UserMapper.class后，便知道了包名，就会在包下扫描到UserMapper接口</span></span><br><span class="line">  UserMapper userMapper = ac.getBean(UserMapper.class);</span><br><span class="line">  User user = userMapper.getUserById(<span class="number">1</span>);</span><br><span class="line">  System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/17/springmvc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="h#">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="learningByDoing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/17/springmvc/" itemprop="url">springmvc</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-17T00:00:00+08:00">2017-11-17</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/JavaWeb/" itemprop="url" rel="index"><span itemprop="name">JavaWeb</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/JavaWeb/SSM框架/" itemprop="url" rel="index"><span itemprop="name">SSM框架</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="springmvc架构"><a href="#springmvc架构" class="headerlink" title="springmvc架构"></a>springmvc架构</h1><ol>
<li>用户请求</li>
<li>前端控制器(DispatcherServlet)转发请求</li>
<li>处理器映射器（HandlerMapping到spring容器中查找所有注册的Controller中是否有符合的请求映射（RequestMapping），若有，则返回相应的包名+类名+方法名（Handler）到前端控制器。</li>
<li>DispatcherServlet请求执行返回的Handler</li>
<li>处理器适配器HandlerAdapter执行Handler，并得到返回的ModelAndView,将ModelAndView交给DispatcherServlet</li>
<li>DispatherServlet拿到ModelAndView后请求解析视图</li>
<li>视图解析器ViewResolver将对应位置的jsp读取到内存当中形成View对象并返回</li>
<li>DispatcherServlet对View进行渲染视图（即将模型数据填充至视图中）。</li>
<li>DispatcherServlet响应用户</li>
</ol>
<p>开发只用配置DispatcherServlet、写Controller即可</p>
<h1 id="基本步骤"><a href="#基本步骤" class="headerlink" title="基本步骤"></a>基本步骤</h1><p>在web.xml中配置DispatcherServlet：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定SpringMVC配置文件 --&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- SpringMVC的配置文件的默认路径是/WEB-INF/$&#123;servlet-name&#125;-servlet.xml --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    /*: 拦截所有url，包括一般过滤器、Servlet不拦截的jsp、js、png、css等</span></span><br><span class="line"><span class="comment">    *.action:拦截以action为结尾的请求</span></span><br><span class="line"><span class="comment">    /：拦截所有url，除了jsp</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.action<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Controller:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// @RequestMapping：里面放的是请求的url，和用户请求的url进行匹配</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value = <span class="string">"/itemlist.action"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">itemList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		List&lt;Item&gt; itemList = <span class="keyword">new</span> ArrayList&lt;Item&gt;();</span><br><span class="line">		</span><br><span class="line">		itemList.add(<span class="keyword">new</span> Item(<span class="number">1</span>, <span class="string">"1华为 荣耀8"</span>, <span class="number">2399</span>, <span class="keyword">new</span> Date(<span class="number">0</span>), <span class="string">"质量好！1"</span>));</span><br><span class="line">		itemList.add(<span class="keyword">new</span> Item(<span class="number">2</span>, <span class="string">"2华为 荣耀8"</span>, <span class="number">2399</span>, <span class="keyword">new</span> Date(<span class="number">0</span>), <span class="string">"质量好！2"</span>));</span><br><span class="line">		itemList.add(<span class="keyword">new</span> Item(<span class="number">3</span>, <span class="string">"3华为 荣耀8"</span>, <span class="number">2399</span>, <span class="keyword">new</span> Date(<span class="number">0</span>), <span class="string">"质量好！3"</span>));</span><br><span class="line">		itemList.add(<span class="keyword">new</span> Item(<span class="number">4</span>, <span class="string">"4华为 荣耀8"</span>, <span class="number">2399</span>, <span class="keyword">new</span> Date(<span class="number">0</span>), <span class="string">"质量好！4"</span>));</span><br><span class="line">		itemList.add(<span class="keyword">new</span> Item(<span class="number">5</span>, <span class="string">"5华为 荣耀8"</span>, <span class="number">2399</span>, <span class="keyword">new</span> Date(<span class="number">0</span>), <span class="string">"质量好！5"</span>));</span><br><span class="line">		itemList.add(<span class="keyword">new</span> Item(<span class="number">6</span>, <span class="string">"6华为 荣耀8"</span>, <span class="number">2399</span>, <span class="keyword">new</span> Date(<span class="number">0</span>), <span class="string">"质量好！6"</span>));</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 创建ModelAndView，用来存放数据和视图</span></span><br><span class="line">		ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">		<span class="comment">// 设置数据到模型中</span></span><br><span class="line">		mav.addObject(<span class="string">"itemList"</span>, itemList);</span><br><span class="line">		<span class="comment">// 设置视图jsp，需要设置视图的物理地址</span></span><br><span class="line">		mav.setViewName(<span class="string">"/WEB-INF/jsp/itemList.jsp"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> mav;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong>不要忘了在springmvc.xml中引入spring的mvc约束并开启注解配置。</p>
<h1 id="springmvc三大组件"><a href="#springmvc三大组件" class="headerlink" title="springmvc三大组件"></a>springmvc三大组件</h1><p>处理器映射器、处理器适配器、视图解析器称为springmvc的三大组件，DispatcherServlet一启动就会默认加载。配置在DispatherServlet.properties文件下。</p>
<p>默认的处理器映射器与处理器适配器虽然还能使用，但都废弃了，需要在springmvc.xml中重新配置。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置处理器映射器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置处理器适配器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>也可这样使用注解驱动来一步加载</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>视图解析器没有废弃，但可以在springmvc.xml中重新配置，来设置页面的前缀与后缀。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/jsp/"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="单个参数绑定"><a href="#单个参数绑定" class="headerlink" title="单个参数绑定"></a>单个参数绑定</h1><p>讲的是Controller中的处理器（方法）的形参</p>
<h2 id="默认参数"><a href="#默认参数" class="headerlink" title="默认参数"></a>默认参数</h2><p>默认可以使用HttpServletRequest、HttpServletResponse、HttpSession、Model、ModelMap作为形参，处理器会自动接收到。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*这样便可获得网页传来的参数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/editItem.action"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">editItem</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Model model)</span> </span>&#123;</span><br><span class="line">    String id = request.getParameter(<span class="string">"id"</span>);</span><br><span class="line">    Item item = itemServiceImpl.selectItemById(Integer.parseInt(id));</span><br><span class="line"></span><br><span class="line">    ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">    mav.addObject(<span class="string">"item"</span>, item);</span><br><span class="line">    mav.setViewName(<span class="string">"editItem"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mav;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="简单类型"><a href="#简单类型" class="headerlink" title="简单类型"></a>简单类型</h2><p>当请求的参数名称和处理器形参名称一致时会将请求参数与形参进行绑定。</p>
<p>这样，从Request取参数的方法就可以进一步简化。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/editItem.action"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">editItem</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//String id = request.getParameter("id");</span></span><br><span class="line">    Item item = itemServiceImpl.selectItemById(id);</span><br><span class="line"></span><br><span class="line">    ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">    mav.addObject(<span class="string">"item"</span>, item);</span><br><span class="line">    mav.setViewName(<span class="string">"editItem"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mav;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="POJO"><a href="#POJO" class="headerlink" title="POJO"></a>POJO</h2><p>要求：pojo对象中的属性名和表单中input的name属性一致。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/updateItem.action"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">updateItem</span><span class="params">(Item item)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//String id = request.getParameter("id");</span></span><br><span class="line">		itemServiceImpl.updateItem(item);</span><br><span class="line">		List&lt;Item&gt; itemList = itemServiceImpl.getItemList();</span><br><span class="line">		</span><br><span class="line">		ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">		mav.addObject(<span class="string">"itemList"</span>, itemList);</span><br><span class="line">		mav.setViewName(<span class="string">"itemList"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> mav;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h3 id="解决post乱码问题"><a href="#解决post乱码问题" class="headerlink" title="解决post乱码问题"></a>解决post乱码问题</h3><p><strong>注意：</strong>此时从表单中获得的数据有可能会造成乱码，可在web.xml中进行编码配置</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="解决get乱码问题"><a href="#解决get乱码问题" class="headerlink" title="解决get乱码问题"></a>解决get乱码问题</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String username = <span class="keyword">new</span> String(request.getparameter(<span class="string">"username"</span>).getBytes(<span class="string">"ISO8859-1"</span>),<span class="string">"UTF-8"</span>);</span><br></pre></td></tr></table></figure>
<h2 id="包装的POJO"><a href="#包装的POJO" class="headerlink" title="包装的POJO"></a>包装的POJO</h2><p>包装对象为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QueryVo</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Item item;</span><br><span class="line">	set/get。。。</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>则在页面中的input元素，其name为item.xxx就可接收。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>商品id<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"item.id"</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>商品名称<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"item.name"</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/queryItem"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">queryItem</span><span class="params">(QueryVo queryVo)</span> </span>&#123;</span><br><span class="line">  System.out.println(queryVo.getItem().getId());</span><br><span class="line">  System.out.println(queryVo.getItem().getName());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="自定义参数"><a href="#自定义参数" class="headerlink" title="自定义参数"></a>自定义参数</h2><p>由于日期数据有很多种格式，springmvc（准确地来说是处理器适配器）没办法把所有形式的字符串都准确地转换成日期类型。所以需要自定义参数。在参数绑定之前，所有参数都会经过一遍转换器，符合转换器转换格式的将进行转换。</p>
<ol>
<li><p>在converter包下构造转化器converter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//由String类型转换为Date类型</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DateConverter</span> <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">String</span>, <span class="title">Date</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">convert</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">		DateFormat dateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy_MM:dd HH-mm--ss"</span>);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Date date = dateFormat.parse(str);</span><br><span class="line">			<span class="keyword">return</span> date;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">			System.out.println(<span class="string">"format error"</span>);</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line"><span class="comment">//		不符合格式就不转换</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在配置适配器处配置converter</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">"conversionService"</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="comment">&lt;!-- 在转换器工厂中可以配置很多转化器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"conversionService"</span> <span class="attr">class</span>=<span class="string">"org.springframework.format.support.FormattingConversionServiceFactoryBean"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"converters"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dateConverter"</span> <span class="attr">class</span>=<span class="string">"cn.converter.DateConverter"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="集合参数绑定"><a href="#集合参数绑定" class="headerlink" title="集合参数绑定"></a>集合参数绑定</h1><p>当用到页面中的checkbox多选框时，需要用数组或集合来接收绑定参数</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;itemList &#125;"</span> <span class="attr">var</span>=<span class="string">"item"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"ids"</span> <span class="attr">value</span>=<span class="string">"$&#123;item.id &#125;"</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;item.name &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;item.price &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">fmt:formatDate</span> <span class="attr">value</span>=<span class="string">"$&#123;item.createtime&#125;"</span> <span class="attr">pattern</span>=<span class="string">"yyyy-MM-dd HH:mm:ss"</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;item.detail &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123;pageContext.request.contextPath &#125;/editItem.action?id=$&#123;item.id&#125;"</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><p>只需让数组名与checkbox的name一致即可接受。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/deleteItems.action"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteItems</span><span class="params">(Integer[] ids)</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="List-有错误"><a href="#List-有错误" class="headerlink" title="List(有错误)"></a>List(有错误)</h2><p>若用list接受，则list必须为包装类的一个属性.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> List&lt;Integer&gt; ids;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实际上是由QueryVo内部的list接收参数</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/deleteItems.action"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteItems</span><span class="params">(QueryVo vo)</span> </span>&#123;</span><br><span class="line">  System.out.println(vo.getIds());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而input的name应该如此设置：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"itemList[$&#123;s.index&#125;].id"</span> <span class="attr">value</span>=<span class="string">"$&#123;item.id &#125;"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="RequestMapping的使用"><a href="#RequestMapping的使用" class="headerlink" title="@RequestMapping的使用"></a>@RequestMapping的使用</h1><h2 id="method属性"><a href="#method属性" class="headerlink" title="method属性"></a>method属性</h2><p>method = RequestMethod.POST，则请求只能为post</p>
<p>method = {RequestMethod.POST, RequestMethod.GET}，则请求可以为get与post</p>
<p>不写，则默认为所有方法都可以</p>
<h2 id="窄化路径"><a href="#窄化路径" class="headerlink" title="窄化路径"></a>窄化路径</h2><p>若在Controller（类）上面添加此注解，则要求所有方法的url请求都得加上同一个前缀。</p>
<p>这样便可以对url进行分类管理</p>
<h2 id="多路径访问"><a href="#多路径访问" class="headerlink" title="多路径访问"></a>多路径访问</h2><p>每个方法可以有多个url映射，因为value属性的值可以是String数组。</p>
<h1 id="Controller层方法返回值"><a href="#Controller层方法返回值" class="headerlink" title="Controller层方法返回值"></a>Controller层方法返回值</h1><ol>
<li><p>ModelAndView</p>
<p>ModelAndView带着数据并返回视图路径</p>
</li>
<li><p>String</p>
<p>形参中要有Model或ModelMap，Model或ModelMap带数据，返回String返回视图路径。官方推荐此种方式，因为其满足解耦思想，即数据与视图分离。</p>
<p>视图路径String写法：</p>
<p>​    1.指定逻辑视图名，通过视图解析器解析为物理视图地址</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="string">"editItem"</span>;</span><br></pre></td></tr></table></figure>
<p>​    2.重定向：”redirect:url”。此处url必须为完整页面地址，不会经过视图解析器解析，或者继续到另一个方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="string">"forward:/WEB-INF/jsp/editItem.jsp"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">"forward:/example.action"</span>;</span><br></pre></td></tr></table></figure>
<p>​    3.内部转发：”forward:url”。此处url必须为完整页面地址，不会经过视图解析器解析，或者继续到另一个方法。</p>
</li>
<li><p>void</p>
<p>形参中要有Model或ModelMap，HttpServletRequest, HttpServletResponse。Model或ModelMap带数据，用request或response的转发或重定向来实现页面跳转。</p>
<p>但此种方式一般都不用来实现页面跳转，一般是用于处理ajax异步请求，只用处理json类型的数据且不用回调。</p>
</li>
</ol>
<h1 id="异常处理器"><a href="#异常处理器" class="headerlink" title="异常处理器"></a>异常处理器</h1><p>在三层架构中遇到的运行时异常都会自动向上抛出，抛到DispatcherServlet。而编译时异常与自己throw的异常（统称为预期异常）也会一直抛到DispatcherServlet。DispatcherServlet将异常交予异常处理器。springmvc有异常处理器的接口HandlerExceptionResolver，而我们只用实现接口并将实现类配置。与自定义参数时所使用的转换器一个道理，只是配置方式有所不同，异常处理器直接实例化就可。</p>
<p>接口实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyExceptionResolver</span> <span class="keyword">implements</span> <span class="title">HandlerExceptionResolver</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Object arg2为异常发生的位置，包名.类名.方法名</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveException</span><span class="params">(HttpServletRequest arg0, HttpServletResponse arg1, Object arg2,</span></span></span><br><span class="line"><span class="function"><span class="params">			Exception arg3)</span> </span>&#123;</span><br><span class="line">		ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">		mav.addObject(<span class="string">"error"</span>, <span class="string">"未知异常"</span>);</span><br><span class="line">		mav.setViewName(<span class="string">"error"</span>);</span><br><span class="line">		<span class="keyword">return</span> mav;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>springmvc.xml配置</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 开启全局异常处理器 --&gt;</span><br><span class="line">&lt;bean id="customExceptionResolver" class="cn.exception.MyExceptionResolver"&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<h1 id="上传文件"><a href="#上传文件" class="headerlink" title="上传文件"></a>上传文件</h1><h2 id="配置tomcat虚拟目录"><a href="#配置tomcat虚拟目录" class="headerlink" title="配置tomcat虚拟目录"></a>配置tomcat虚拟目录</h2><p>双击tomcat，在Modules下加入Path：/pic，Document Base设置为/Users/h/Desktop/pic。访问<a href="http://localhost:8080/pic即可访问/Users/h/Desktop/pic下的图片。" target="_blank" rel="noopener">http://localhost:8080/pic即可访问/Users/h/Desktop/pic下的图片。</a></p>
<h2 id="指定form的enctype属性"><a href="#指定form的enctype属性" class="headerlink" title="指定form的enctype属性"></a>指定form的enctype属性</h2><p>上传文件时form需要指定属性 enctype=”multipart/form-data”</p>
<h2 id="加入上传文件的两个jar包"><a href="#加入上传文件的两个jar包" class="headerlink" title="加入上传文件的两个jar包"></a>加入上传文件的两个jar包</h2><h2 id="springmvc配置”文件上传”解析器"><a href="#springmvc配置”文件上传”解析器" class="headerlink" title="springmvc配置”文件上传”解析器"></a>springmvc配置”文件上传”解析器</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 文件上传,id必须设置为multipartResolver</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">class</span>=<span class="string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 设置文件上传大小，以B为单位 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxUploadSize"</span> <span class="attr">value</span>=<span class="string">"5000000"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样，容器中就会生成MultipartFile接口的实现类。便可在Controller的处理器中使用。</p>
<h2 id="实现MultipartFile接口"><a href="#实现MultipartFile接口" class="headerlink" title="实现MultipartFile接口"></a>实现MultipartFile接口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实现类的名字必须要与网页中&lt;input type="file" name="pictureFile"&gt;的name相同	</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/updateItem.action"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">updateItem</span><span class="params">(Item item, MultipartFile pictureFile)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">     	<span class="comment">//获取文件的全名</span></span><br><span class="line">	String filename = pictureFile.getOriginalFilename();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//以UUID形式保存，UUID是36个字符+四个'-'</span></span><br><span class="line">	String name = UUID.randomUUID().toString().replaceAll(<span class="string">"-"</span>, <span class="string">""</span>);</span><br><span class="line">	<span class="comment">//用FilenameUtils获取文件名后缀</span></span><br><span class="line">	String ext = FilenameUtils.getExtension(filename);</span><br><span class="line">	</span><br><span class="line">     	<span class="comment">//保存到磁盘上</span></span><br><span class="line">	pictureFile.transferTo(<span class="keyword">new</span> File(<span class="string">"/Users/h/Desktop/pic/"</span> + name + <span class="string">"."</span> + ext));</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//因为网页上的图片是file类型，而item中的pic属性为String类型，只保存文件名，因此这两个对不上号，pic属性就可以我们自己来设置。</span></span><br><span class="line">	item.setPic(name + <span class="string">"."</span> + ext);</span><br><span class="line">	itemServiceImpl.updateItem(item);</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"redirect:/editItem.action?id="</span> + item.getId();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="json数据交互"><a href="#json数据交互" class="headerlink" title="json数据交互"></a>json数据交互</h1><h2 id="RequestBody与-ResponseBody"><a href="#RequestBody与-ResponseBody" class="headerlink" title="@RequestBody与@ResponseBody"></a>@RequestBody与@ResponseBody</h2><p>@RequestBody注解用于读取http请求的内容(字符串)，通过springmvc提供的HttpMessageConverter接口将读到的内容（json数据）转换为java对象并绑定到Controller方法的参数上。</p>
<p>@ResponseBody注解用于将Controller的方法返回的对象，通过springmvc提供的HttpMessageConverter接口转换为指定格式的数据如：json,xml等，通过Response响应给客户端</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//只要json字符串中的数据key与item中的属性名相同，value就会自动封装到item的属性中。</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/json.action"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@ResponseBody</span> <span class="function">Item <span class="title">json</span><span class="params">(@RequestBody Item item)</span> </span>&#123;</span><br><span class="line">    System.out.println(item);</span><br><span class="line">  	<span class="comment">//返回item,springmvc会自动将其解析成json回调给ajax引擎</span></span><br><span class="line">    <span class="keyword">return</span> item;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="json交互方式"><a href="#json交互方式" class="headerlink" title="json交互方式"></a>json交互方式</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  	<span class="comment">//json字符串一定是json格式再加字符串</span></span><br><span class="line">	<span class="keyword">var</span> params = <span class="string">'&#123;"id":4, "name":"试试json", "price":5000, "detail":"meiyou","pic": "123456.jpg"&#125;'</span></span><br><span class="line">	$.ajax(&#123;</span><br><span class="line">		url : <span class="string">"$&#123;pageContext.request.contextPath&#125;/json.action"</span>,  <span class="comment">//服务器得到的请求</span></span><br><span class="line">      	type : <span class="string">"post"</span>,	<span class="comment">//所得请求的方式</span></span><br><span class="line">		data : params,	<span class="comment">//服务器得到的数据</span></span><br><span class="line">		contentType : <span class="string">"application/json;charset=UTF-8"</span>,	<span class="comment">//得到的数据格式</span></span><br><span class="line">		dataType : <span class="string">"json"</span>,<span class="comment">//回调的数据格式</span></span><br><span class="line">		success : <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">			alert(data.name);</span><br><span class="line">		&#125;<span class="comment">//回调后所执行的方法，这里的data是服务器回调的数据</span></span><br><span class="line">	&#125;);</span><br><span class="line">	</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h1><p>实现拦截器接口后有三个方法，分别作用于Controller层方法执行前、Controller层方法执行后、视图解析（页面渲染）后。</p>
<h2 id="配置拦截器"><a href="#配置拦截器" class="headerlink" title="配置拦截器"></a>配置拦截器</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 拦截所有请求 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span> = <span class="string">"myInterceptor"</span> <span class="attr">class</span>=<span class="string">"cn.interceptor.MyInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="实现拦截器接口"><a href="#实现拦截器接口" class="headerlink" title="实现拦截器接口"></a>实现拦截器接口</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest arg0, HttpServletResponse arg1, Object arg2)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"pre"</span>);</span><br><span class="line">		<span class="comment">//return的值决定放行或不放行</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest arg0, HttpServletResponse arg1, Object arg2, ModelAndView arg3)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"post"</span>);		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest arg0, HttpServletResponse arg1, Object arg2, Exception arg3)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"after"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="拦截器的执行顺序"><a href="#拦截器的执行顺序" class="headerlink" title="拦截器的执行顺序"></a>拦截器的执行顺序</h1><p>preHandle按拦截器定义顺序调用</p>
<p>postHandler按拦截器定义逆序调用</p>
<p>afterCompletion按拦截器定义逆序调用</p>
<p>postHandler在拦截器链内所有拦截器返成功调用</p>
<p>afterCompletion只用preHandle返回true就可以调用</p>
<h1 id="加载静态资源"><a href="#加载静态资源" class="headerlink" title="加载静态资源"></a>加载静态资源</h1><p>web.xml配置时，若设置所有的请求都进入SpringMVC，则加载css、js时也会先进入SpringMVC，但SpringMVC无法处理，导致页面不能正常显示。因此要将请求限定为以action结尾。</p>
<h1 id="在controller层读取properties文件"><a href="#在controller层读取properties文件" class="headerlink" title="在controller层读取properties文件"></a>在controller层读取properties文件</h1><p>可解决controller层的部分硬编码问题</p>
<p>先在springmvc.xml中进行配置：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:env.properties"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>便可以在controller层进行赋值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;CUSTOMER_FROM_TYPE&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String CUSTOMER_FROM_TYPE;</span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;CUSTOMER_FROM_TYPE&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String CUSTOMER_INDUSTRY_TYPE;</span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"&#123;CUSTOMER_LEVEL_TYPE&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String CUSTOMER_LEVEL_TYPE;</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong>applicationContext.xml中也有<context:property-placeholder>标签，整个环境中这个标签只能指向一个配置文件。因此要把db.properties中的配置都转移到env.properties中去。    </context:property-placeholder></p>
<h1 id="Springmvc与Struts2的区别"><a href="#Springmvc与Struts2的区别" class="headerlink" title="Springmvc与Struts2的区别"></a>Springmvc与Struts2的区别</h1><p>1、springmvc的入口是一个servlet即前端控制器，而struts2入口是一个filter过滤器。</p>
<p>2、springmvc是基于方法开发(一个url对应一个方法)，请求参数传递到方法的形参，可以设计为单例或多例(建议单例)，struts2是基于类开发，传递参数是通过类的属性，只能设计为多例。</p>
<p>3、Struts采用值栈存储请求和响应的数据，通过OGNL存取数据， springmvc通过参数解析器是将request请求内容解析，并给方法形参赋值，将数据和视图封装成ModelAndView对象，最后又将ModelAndView中的模型数据通过request域传输到页面。Jsp视图解析器默认使用jstl。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/13/git/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="h#">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="learningByDoing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/13/git/" itemprop="url">git 基本使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-13T00:00:00+08:00">2017-11-13</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/git/" itemprop="url" rel="index"><span itemprop="name">git</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;Your Name&quot;	设置用户名</span><br><span class="line">git config --global user.email &quot;email@example.com&quot;	设置用户邮箱</span><br><span class="line">git init	创建 git 仓库</span><br><span class="line">git add	filename	把文件添加到仓库</span><br><span class="line">git commit -m &quot;somemessages&quot;	把文件提交到仓库</span><br><span class="line">git status		查看仓库的当前状态</span><br><span class="line">git diff		查看仓库的修改内容</span><br><span class="line">git log			查看日志</span><br><span class="line">git reset --hard HEAD^		回退到上个版本</span><br><span class="line">git reset --hard 3628164	回退到版本号以3628164开头的版本</span><br><span class="line">git reset HEAD fileName			把暂存区的修改撤销掉</span><br><span class="line">git reflog		查看每一条命令</span><br><span class="line">git checkout -- filename		使文件回到最近一次 commit 或者 add 时的状态</span><br><span class="line">git rm		从版本库中删除文件</span><br><span class="line">git remote add origin git@github.com:GitHubUserName/GitHubRepositoryName.git	将本地仓库与远程仓库关联，远程仓库名字为 origin</span><br><span class="line">git push -u origin master		推送本地的 master 分支，并将远程仓库中的新的 master 分支与本地的 master 分支关联起来。</span><br><span class="line">git checkout -b dev		创建并切换到dev 分支</span><br><span class="line">git checkout -b dev origin/dev		创建远程 origin 的 dev 粉猪到本地</span><br><span class="line">git branch dev		创建 dev 分支</span><br><span class="line">git checkout dev		切换到 dev 分支</span><br><span class="line">git branch		查看当前分支</span><br><span class="line">git merge dev	将 dev 分支合并到当前分支</span><br><span class="line">git branch -d dev		删除 dev 分支</span><br><span class="line">git branch -D dev		在没合并前强制删除 dev 分支</span><br><span class="line">git stash	保存当前工作现场</span><br><span class="line">git stash list	查看所有保存的工作现场</span><br><span class="line">git stash pop	恢复现场的同时删除stash内容</span><br><span class="line">git remote	查看远程库的信息</span><br><span class="line">git remote -v	查看远程库的详细信息</span><br><span class="line">git branch --set-upstream dev origin/dev	设置本地与远程的分支链接</span><br><span class="line">git pull	从远程抓取分支</span><br><span class="line">git tag v1.0	给当前分支的当前版本打上标签 v1.0</span><br><span class="line">git tag 查看所有标签</span><br><span class="line">git tag v0.9 6224937	给指定版本号打上标签</span><br><span class="line">git show tagName	显示指定标签的信息</span><br><span class="line">git tag -a v0.3 -m &quot;version 0.3 released&quot; a572025	给指定版本号打上名为 v0.3的标签，标签信息为...</span><br><span class="line">git tag -d v0.1		删除标签</span><br><span class="line">git push origin v1.0	将 v1.0标签推送到远程仓库</span><br><span class="line">git push origin --tags		将全部标签都推送到远程仓库</span><br><span class="line">git push origin :refs/tags/v0.9		删除远程仓库的 v0.9标签</span><br></pre></td></tr></table></figure>
<h2 id="关于回退："><a href="#关于回退：" class="headerlink" title="关于回退："></a>关于回退：</h2><p>场景1：当你改乱了工作区某个文件的内容，想直接丢弃工作区的修改时，用命令<code>git checkout -- file</code>。</p>
<p>场景2：当你不但改乱了工作区某个文件的内容，还添加到了暂存区时，想丢弃修改，分两步，第一步用命令<code>git reset HEAD file</code>，就回到了场景1，第二步按场景1操作。</p>
<p>场景3：已经提交了不合适的修改到版本库时，想要撤销本次提交，就进行版本回退<code>git reset --hard HEAD^</code></p>
<h2 id="关于冲突："><a href="#关于冲突：" class="headerlink" title="关于冲突："></a>关于冲突：</h2><h3 id="本地："><a href="#本地：" class="headerlink" title="本地："></a>本地：</h3><p>引起冲突的原因：</p>
<p>不同的分支对相同的文件作了不同的更改，且都提交到了本地库中。则会在合并分支时产生冲突。</p>
<p>当Git无法自动合并分支时，就必须首先解决冲突。</p>
<ol>
<li><code>git status</code>查看哪个文件起的冲突</li>
<li>查看文件内容，冲突位置会被标识出来</li>
<li>将文件内容做合理修改，使所有分支提交的内容是一样的</li>
</ol>
<p>解决冲突后，再提交，就相当于完成了合并。</p>
<p>用<code>git log --graph</code>命令可以看到分支合并图。</p>
<h3 id="远程："><a href="#远程：" class="headerlink" title="远程："></a>远程：</h3><p>向远程推送分支时，有别人在自己修改的同时也做了修改并已推送，便会产生冲突。</p>
<ol>
<li><code>git branch --set-upstream dev origin/dev</code>设置本地与远程的分支链接</li>
<li><code>git pull</code>把最新的提交从远程库中抓下来，然后在本地解决冲突再推送。</li>
</ol>
<p>### </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/01/hibernate/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="h#">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="learningByDoing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/01/hibernate/" itemprop="url">hibernate</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-01T00:00:00+08:00">2017-11-01</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/JavaWeb/" itemprop="url" rel="index"><span itemprop="name">JavaWeb</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/JavaWeb/SSH框架/" itemprop="url" rel="index"><span itemprop="name">SSH框架</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="框架搭建"><a href="#框架搭建" class="headerlink" title="框架搭建"></a>框架搭建</h1><h2 id="1-导包"><a href="#1-导包" class="headerlink" title="1.导包"></a>1.导包</h2><h2 id="2-准备数据库与Bean对象"><a href="#2-准备数据库与Bean对象" class="headerlink" title="2.准备数据库与Bean对象"></a>2.准备数据库与Bean对象</h2><h2 id="3-书写orm元数据（对象与数据库表的映射文件-hbm-xml）"><a href="#3-书写orm元数据（对象与数据库表的映射文件-hbm-xml）" class="headerlink" title="3.书写orm元数据（对象与数据库表的映射文件.hbm.xml）"></a>3.书写orm元数据（对象与数据库表的映射文件.hbm.xml）</h2><h2 id="4-书写主配置文件"><a href="#4-书写主配置文件" class="headerlink" title="4.书写主配置文件"></a>4.书写主配置文件</h2><h2 id="5-书写代码测试"><a href="#5-书写代码测试" class="headerlink" title="5.书写代码测试"></a>5.书写代码测试</h2><h1 id="配置文件详解"><a href="#配置文件详解" class="headerlink" title="配置文件详解"></a>配置文件详解</h1><h2 id="hbm-xml"><a href="#hbm-xml" class="headerlink" title=".hbm.xml"></a>.hbm.xml</h2><p>​    1.约束（hibernate-mapping-3.0.dtd）</p>
<p>​    2.<hibernate-mapping pacakge(可选)="指定类的包名"></hibernate-mapping></p>
<p>​        <class name="类名" table="表名"></class></p>
<p>​            <id name="主键名" column="列名"></id></p>
<p>​                column也可不填，默认值为name值</p>
<p>​                若映射关系填错，如name=”a”,column=”b”,则会自动在数据库中建一个b列</p>
<p>​            <property name="其它属性名" column="列名"></property></p>
<h2 id="hibernate-cfg-xml"><a href="#hibernate-cfg-xml" class="headerlink" title="hibernate.cfg.xml"></a>hibernate.cfg.xml</h2><p>​    1.约束（hibernate-configuration-3.0.dtd）</p>
<p>​    2.<hibernate-configuration></hibernate-configuration></p>
<p>​        <session-factory></session-factory></p>
<p>​            <property>*5(必填) mysql</property></p>
<p>​            <property>*3(选填) show_sql、format_sql、hbm2ddl.auto</property></p>
<p>​            <mapping resouce="路径"> 导入映射关系，路径为src下的hmb.xml路径</mapping></p>
<h1 id="API详解"><a href="#API详解" class="headerlink" title="API详解"></a>API详解</h1><h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置加载类，用于加载主配置与orm元数据，创建工厂</span></span><br><span class="line">Configuration conf = <span class="keyword">new</span> Configuration()  <span class="comment">//空参创造</span></span><br><span class="line">conf.configure() <span class="comment">//加载主配置文件hibernate.cfg.xml</span></span><br><span class="line">SessionFactory sf = conf.buildSessionFactory()</span><br></pre></td></tr></table></figure>
<h2 id="SessionFactory"><a href="#SessionFactory" class="headerlink" title="SessionFactory"></a>SessionFactory</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建操作数据库的核心对象session，负责保存和使用所有配置信息，消耗内存资源大</span></span><br><span class="line"><span class="comment">//线程安全。保证在WEB应用中，只创建一个SessionFactory。</span></span><br><span class="line">Session session = sf.openSession()    <span class="comment">//打开新的Session对象</span></span><br></pre></td></tr></table></figure>
<h2 id="Session（核心）"><a href="#Session（核心）" class="headerlink" title="Session（核心）"></a>Session（核心）</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//表达hibernate框架与数据库之间的连接/会话</span></span><br><span class="line">Transaction tx = session.beginTransaction()  <span class="comment">//获得操作事务的Transaction对象并开启</span></span><br><span class="line"><span class="comment">//开启后便可进行数据库操作</span></span><br><span class="line">Customer c = <span class="keyword">new</span> Customer()</span><br><span class="line">c.set_cstName(<span class="string">"a"</span>)</span><br><span class="line">session.save(c)  <span class="comment">//增</span></span><br><span class="line">session.get(Customer.class, <span class="number">1l</span>)  <span class="comment">//查   param1指实体类名，param2指主键的值</span></span><br><span class="line">Customer c = session.get(Customer.class, <span class="number">1l</span>); c.set_cstName(<span class="string">"b"</span>); session.update(c) <span class="comment">//改</span></span><br><span class="line">Customer c = session.get(Customer.class, <span class="number">1l</span>); </span><br><span class="line">session.delete(c) <span class="comment">//删</span></span><br><span class="line"><span class="comment">//这边的增删改查都是错的，应该是对象状态的变化</span></span><br></pre></td></tr></table></figure>
<h2 id="Transaction"><a href="#Transaction" class="headerlink" title="Transaction"></a>Transaction</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tx2.commit() <span class="comment">//提交事务</span></span><br><span class="line">tx2.rollback() <span class="comment">//回滚事务</span></span><br></pre></td></tr></table></figure>
<p>最后要记得释放资源：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">session.close()</span><br><span class="line">sf.close()</span><br></pre></td></tr></table></figure>
<h1 id="封装Utils工具类"><a href="#封装Utils工具类" class="headerlink" title="封装Utils工具类"></a>封装Utils工具类</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SessionFactory sf;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        Configuration conf = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line">        sf = conf.buildSessionFactory();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title">openSession</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Session session = sf.openSession();</span><br><span class="line">        <span class="keyword">return</span> session;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title">getCurrentSession</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Session session = sf.getCurrentSession();</span><br><span class="line">        <span class="keyword">return</span> session;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        System.out.println(HibernateUtils.openSession());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="hibernate中的实体规则"><a href="#hibernate中的实体规则" class="headerlink" title="hibernate中的实体规则"></a>hibernate中的实体规则</h1><h2 id="实体类创建规则"><a href="#实体类创建规则" class="headerlink" title="实体类创建规则"></a>实体类创建规则</h2><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol>
<li>持久化类提供无参构造</li>
<li>成员变量私有，提供公有get/set方法访问，成一个属性</li>
<li>持久化类中的属性，应尽量使用包装类型</li>
<li>持久化类要提供oid，与数据库中的主键对应</li>
<li>不要用final修饰class，因为hibernate要用cglib代理生成代理对象，而代理对象要继承被代理对象，不可用final修饰。</li>
</ol>
<h1 id="主键生成策略"><a href="#主键生成策略" class="headerlink" title="主键生成策略"></a>主键生成策略</h1><h2 id="主键类型"><a href="#主键类型" class="headerlink" title="主键类型"></a>主键类型</h2><ol>
<li><p>自然主键（NK，不多见）</p>
<p>业务列中有某一列，必须存在且不重复，则该列可作为主键，如身份证号</p>
</li>
<li><p>代理主键（SK，常见）</p>
</li>
</ol>
<h2 id="主键生成策略：每条记录录入时，主键的生成规则"><a href="#主键生成策略：每条记录录入时，主键的生成规则" class="headerlink" title="主键生成策略：每条记录录入时，主键的生成规则"></a>主键生成策略：每条记录录入时，主键的生成规则</h2><ol>
<li><strong>identity</strong>:主键自增.由数据库维护主键值</li>
<li>increment:主键自增。由hibernate维护，每次插入前查询最大主键值并+1。不可用，有线程安全问题。</li>
<li><strong>sequence</strong>:Oracle中的主键生成策略</li>
<li>hilo:以高低位算法进行主键自增，由hibernate维护。开发时不使用。</li>
<li><strong>native</strong>:hilo+sequence+identity，自动三选一策略</li>
<li><strong>uuid</strong>:产生不会重复的随机字符串.此时的主键类型必须为String</li>
<li><strong>assigned</strong>:自然主键生成策略。由开发人员自己录入。</li>
</ol>
<h1 id="hibernate中的对象状态"><a href="#hibernate中的对象状态" class="headerlink" title="hibernate中的对象状态"></a>hibernate中的对象状态</h1><ol>
<li>瞬时状态：没有id,没有与session关联，即没有在session缓存中</li>
<li>持久化状态：有id，与session关联，即存在于session缓存中。持久化状态对象的任何变化都会自动同步到数据库中。</li>
<li>游离|托管状态：有id，没与session关联，即没有在session缓存中</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Customer c = <span class="keyword">new</span> Customer(); <span class="comment">//瞬时状态</span></span><br><span class="line">c.set_cstName(<span class="string">'a'</span>); <span class="comment">//瞬时状态</span></span><br><span class="line">session.save(c); <span class="comment">//持久化状态     主键自增</span></span><br><span class="line">tx.commit();</span><br><span class="line">session.close(); <span class="comment">//托管状态</span></span><br></pre></td></tr></table></figure>
<ol>
<li>save方法其实不能理解为保存，它本质是将对象从瞬时状态转化为持久化状态。当主键生成策略是identity时，打印的是insert；当主键生成策略是increment时，打印出来的sql语句是select。</li>
<li>update方法使对象从游离|托管状态转化为持久化状态</li>
<li>get方法一使用便得到处于持久化状态的对象</li>
<li>delete方法使对象从持久化状态转化为瞬时状态</li>
<li>对象调用saveOrUpdate方法，不管其状态是瞬时还是游离，都会变成持久化</li>
</ol>
<p><strong>结论</strong>：将我们希望同步到数据库的数据，对应的对象转换为持久化状态</p>
<h1 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a>一级缓存</h1><p>程序在用hibernate与数据库进行交互时，会有hibernate的缓存与快照。缓存能提高查询速率，快照能减少不必要的修改语句，直到tx.commit()时才与数据库发生交互。</p>
<h1 id="事务管理"><a href="#事务管理" class="headerlink" title="事务管理"></a>事务管理</h1><h2 id="指定数据库的隔离级别"><a href="#指定数据库的隔离级别" class="headerlink" title="指定数据库的隔离级别"></a>指定数据库的隔离级别</h2><p>在主配置文件中添加属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;property name=&quot;hibernate.connection.isolation&quot;&gt;</span><br><span class="line">1|2|4|8</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">//默认为4(mysql默认隔离级别，可重复读)</span><br></pre></td></tr></table></figure>
<p>隔离级别在mysql中以字节存储，分别为：</p>
<p>0001：读未提交</p>
<p>0010：读已提交</p>
<p>0100：可重复读</p>
<p>1000：串行化</p>
<h2 id="如何管理事务"><a href="#如何管理事务" class="headerlink" title="如何管理事务"></a>如何管理事务</h2><ol>
<li><p>在业务开始前，打开事务。业务执行后，提交事务。执行过程若发生异常，则回滚事务。</p>
</li>
<li><p>service层控制事务。service用到的session对象与dao用到的session对象要确保是同一个。要在hibernate主配置文件中添加属性:</p>
<p><property name="hibernate.current_session_context_class"><br>thread<br></property><br>后，才可以在dao层调用sf.getCurrentSession()</p>
<p><strong>注意</strong>：通过getCurrentSession()获得的session，在事务提交后会自动关闭，不用手动关闭，否则会报错。</p>
</li>
</ol>
<h1 id="批量查询"><a href="#批量查询" class="headerlink" title="批量查询"></a>批量查询</h1><h2 id="HQL查询-多表查询，且不复杂"><a href="#HQL查询-多表查询，且不复杂" class="headerlink" title="HQL查询(多表查询，且不复杂)"></a>HQL查询(多表查询，且不复杂)</h2><p>HQL中不会出现与数据库相关的信息，如表名、列名</p>
<h3 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String hql = <span class="string">"select * from Customer where cust_id=1"</span>; <span class="comment">//select * 可以省略</span></span><br><span class="line">Query query = session.createQuery(hql);</span><br><span class="line">Customer c = (Customer)query.uniqueResult()<span class="comment">//只返回单个结果</span></span><br><span class="line">List&lt;Customer&gt; customers = query.list()<span class="comment">//返回多个结果</span></span><br></pre></td></tr></table></figure>
<h4 id="问号占位符"><a href="#问号占位符" class="headerlink" title="问号占位符"></a>问号占位符</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span> hql = <span class="string">"select * from Customer where cust_id=?"</span>; <span class="comment">//select * 可以省略</span></span><br><span class="line">Query query = session.createQuery(hql);</span><br><span class="line">query.setLong(<span class="number">0</span>,<span class="number">1</span>l);</span><br><span class="line">query.setParameter(<span class="number">0</span>,<span class="number">1</span>); <span class="comment">//会自动进行类型转换</span></span><br><span class="line">Customer c = (Customer)query.uniqueResult()<span class="comment">//只返回单个结果</span></span><br><span class="line">List&lt;Customer&gt; customers = query.list()<span class="comment">//返回多个结果</span></span><br></pre></td></tr></table></figure>
<h4 id="命名占位符"><a href="#命名占位符" class="headerlink" title="命名占位符"></a>命名占位符</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String hql = <span class="string">"select * from Customer where cust_id = :cust_id"</span>; <span class="comment">//select * 可以省略</span></span><br><span class="line">Query query = session.createQuery(hql);</span><br><span class="line">query.setParameter(<span class="string">"cust_id"</span>,<span class="number">1l</span>);</span><br><span class="line">Customer c = (Customer)query.uniqueResult()<span class="comment">//只返回单个结果</span></span><br><span class="line">List&lt;Customer&gt; customers = query.list()<span class="comment">//返回多个结果</span></span><br></pre></td></tr></table></figure>
<h3 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String hql = <span class="string">"select * from Customer"</span>; <span class="comment">//select * 可以省略</span></span><br><span class="line">Query query = session.createQuery(hql);</span><br><span class="line">query.setFirstResult(arg0); <span class="comment">//起始索引</span></span><br><span class="line">query.setMaxResult(arg1); <span class="comment">//行数</span></span><br><span class="line">Customer c = (Customer)query.uniqueResult()<span class="comment">//只返回单个结果</span></span><br><span class="line">List&lt;Customer&gt; customers = query.list()<span class="comment">//返回多个结果</span></span><br></pre></td></tr></table></figure>
<h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String hql = <span class="string">"from domain.Customer order by cust_id asc/desc"</span>;</span><br><span class="line">Query query = session.createQuery(hql);</span><br><span class="line">List&lt;Customer&gt; customers = query.list()<span class="comment">//返回多个结果</span></span><br></pre></td></tr></table></figure>
<h3 id="特殊的投影查询"><a href="#特殊的投影查询" class="headerlink" title="特殊的投影查询"></a>特殊的投影查询</h3><p>普通的投影查询就是查数据库中的某列，如cust_id</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用条件：Customer对象中要有对应的构造方法</span></span><br><span class="line">String hql = <span class="string">"select new Customer(cust_id, cust_name) from domain.Customer"</span>;</span><br><span class="line">Query query = session.createQuery(hql);</span><br><span class="line">List&lt;Customer&gt; customers = query.list()<span class="comment">//返回多个结果</span></span><br></pre></td></tr></table></figure>
<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String hql = <span class="string">" from Object"</span></span><br></pre></td></tr></table></figure>
<p>此为查找Object所有子类对象。查找主配置下的所有映像文件，一一查找。开发中若用这个，一般都会内存溢出，没什么用。</p>
<h2 id="Criteria查询（单表查询）"><a href="#Criteria查询（单表查询）" class="headerlink" title="Criteria查询（单表查询）"></a>Criteria查询（单表查询）</h2><p>Hibernate自创的无语句面向对象查询</p>
<h3 id="条件查询-1"><a href="#条件查询-1" class="headerlink" title="条件查询"></a>条件查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//条件为add Restrictions形式</span></span><br><span class="line"><span class="comment">//	&gt;	gt</span></span><br><span class="line"><span class="comment">//	&lt;	lt等等</span></span><br><span class="line">Criteria criteria = session.createCriteria(Customer.class);</span><br><span class="line">criteria.add(Restrictions.eq(<span class="string">"cust_id"</span>, <span class="number">1l</span>))  <span class="comment">//设置条件</span></span><br><span class="line">Customer c = (Customer)criteria.uniqueResult();</span><br></pre></td></tr></table></figure>
<h3 id="分页查询-1"><a href="#分页查询-1" class="headerlink" title="分页查询"></a>分页查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Criteria criteria = session.createCriteria(Customer.class);</span><br><span class="line"><span class="comment">//arg0与arg1分别对应limit的两个参数</span></span><br><span class="line">criteria.setFirstResult(arg0)</span><br><span class="line">criteria.setMaxResult(arg1)</span><br><span class="line">Customer customers = criteria.list();</span><br></pre></td></tr></table></figure>
<h3 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a>聚合查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//聚合为Projections形式</span></span><br><span class="line">Criteria criteria = session.createCriteria(Customer.class);</span><br><span class="line">criteria.setProjection(Projections.rowCount());  <span class="comment">//总行数</span></span><br><span class="line">Long count = (Long)criteria.uniqueResult();</span><br></pre></td></tr></table></figure>
<h3 id="排序-1"><a href="#排序-1" class="headerlink" title="排序"></a>排序</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Criteria criteria = session.createCriteria(Customer.class);</span><br><span class="line">criteria.addOrder(Order.asc(propertyName)); </span><br><span class="line">criteria.addOrder(Order.desc(propertyName)); </span><br><span class="line">List list = criteria.list()</span><br></pre></td></tr></table></figure>
<h3 id="离线模式的Criteria"><a href="#离线模式的Criteria" class="headerlink" title="离线模式的Criteria"></a>离线模式的Criteria</h3><p>离线Criteria不用依赖于session，其一般在service层创建并添加约束，然后传到dao层转化为Criteria执行。因此dao层的代码几乎不用变。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DetachedCriteria dc = DetachedCriteria.forClass(Customer.class);</span><br><span class="line">dc.add(Restrictions.idEq(<span class="number">6l</span>));  <span class="comment">//添加约束条件</span></span><br><span class="line">--------dao----------</span><br><span class="line">Criteria c = dc.getExecutableCriteria(session);  <span class="comment">//获得可执行的Criteria</span></span><br><span class="line">List list = c.list();</span><br></pre></td></tr></table></figure>
<h2 id="原生sql查询（复杂的业务查询，常用）"><a href="#原生sql查询（复杂的业务查询，常用）" class="headerlink" title="原生sql查询（复杂的业务查询，常用）"></a>原生sql查询（复杂的业务查询，常用）</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String sql = <span class="string">"select * from cst_customer where cst_name=? limit ?,?"</span>;</span><br><span class="line">SQLQuery query = session.createSQLQuery(sql);</span><br><span class="line">query.addEntity(Customer.class)<span class="comment">//指定将结果集封装到Customer对象中，不然是Object[]</span></span><br><span class="line">List&lt;Customer&gt; list = query.list();</span><br></pre></td></tr></table></figure>
<h1 id="查询优化"><a href="#查询优化" class="headerlink" title="查询优化"></a>查询优化</h1><h2 id="对象级别优化策略"><a href="#对象级别优化策略" class="headerlink" title="对象级别优化策略"></a>对象级别优化策略</h2><h3 id="懒加载-延迟加载"><a href="#懒加载-延迟加载" class="headerlink" title="懒加载/延迟加载"></a>懒加载/延迟加载</h3><p><strong>基本原理</strong>：从数据库取得的对象，并不是真正的类对象，而是以对象代理的形式存在。只有在要真正使用类对象时，才会将代理对象转换为类对象，即发出sql语句，从数据库中获得数据。</p>
<p>get：执行方法时立即发送Sql语句查询结果</p>
<p>load：作用与get相同，默认为懒加载。</p>
<p>可以在类的元数据配置中，设定class元素的lazy属性来控制是否对类进行延迟加载，仅对可以延迟加载的方法（如load）有效。</p>
<p><strong>注意</strong>：使用懒加载时要确保调用从数据库获得的代理对象时，session还是打开的，不然会抛出异常：代理对象初始化异常。</p>
<h2 id="集合级别优化策略"><a href="#集合级别优化策略" class="headerlink" title="集合级别优化策略"></a>集合级别优化策略</h2><p>与对象级别相对应，可以在类的元数据配置中，设定set元素的lazy属性与fetch属性来决定是否对集合进行延迟加载及如何加载，即使用什么类型的sql语句。</p>
<h3 id="延迟加载"><a href="#延迟加载" class="headerlink" title="延迟加载"></a>延迟加载</h3><p>lazy属性有三个值：</p>
<ol>
<li>true（默认）</li>
<li>false</li>
<li>extra：极其懒惰</li>
</ol>
<h3 id="加载策略"><a href="#加载策略" class="headerlink" title="加载策略"></a>加载策略</h3><p>fetch属性有三个值：</p>
<ol>
<li>select(默认)：单表查询加载</li>
<li>join：多表查询加载，lazy属性失效，全都立即加载</li>
<li>subselect：自查询加载</li>
</ol>
<h1 id="一对多-amp-多对一关系"><a href="#一对多-amp-多对一关系" class="headerlink" title="一对多&amp;多对一关系"></a>一对多&amp;多对一关系</h1><h2 id="在对象中的表达"><a href="#在对象中的表达" class="headerlink" title="在对象中的表达"></a>在对象中的表达</h2><p>一的一方用集合（SET）来持有多的一方，多的一方用对象引用一的一方</p>
<h2 id="在orm元数据中的表达"><a href="#在orm元数据中的表达" class="headerlink" title="在orm元数据中的表达"></a>在orm元数据中的表达</h2><h3 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	name属性：set集合名称</span></span><br><span class="line"><span class="comment">	column属性：外键名称</span></span><br><span class="line"><span class="comment">	class属性：多的一方的完整类名</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"linkMens"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"lkm_cust_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"domain.LinkMan"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="多对一"><a href="#多对一" class="headerlink" title="多对一"></a>多对一</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	name属性：set集合名称</span></span><br><span class="line"><span class="comment">	column属性：外键名称		这里的column必须要与上面的一致</span></span><br><span class="line"><span class="comment">	class属性：多的一方的完整类名</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"customer"</span> <span class="attr">column</span>=<span class="string">"lkm_cust_id"</span> <span class="attr">class</span>=<span class="string">"domain.Customer"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="关系的基本操作"><a href="#关系的基本操作" class="headerlink" title="关系的基本操作"></a>关系的基本操作</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Customer c = <span class="keyword">new</span> Customer();</span><br><span class="line">LinkMan lm1 = <span class="keyword">new</span> LinkMan();</span><br><span class="line">LinkMan lm2 = <span class="keyword">new</span> LinkMan();</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加</span></span><br><span class="line">c.getLinkMens().add(lm1);</span><br><span class="line">c.getLinkMens().add(lm2);</span><br><span class="line">lm1.setCustomer(c);</span><br><span class="line">lm2.setCustomer(c);</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除</span></span><br><span class="line">c.getLinkMens().remove(lm1);</span><br><span class="line">lm1.setCustomer(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">session.sava(c);</span><br><span class="line">session.save(lm1);</span><br><span class="line">session.save(lm2);</span><br></pre></td></tr></table></figure>
<h2 id="级联操作（cascade-简化操作）"><a href="#级联操作（cascade-简化操作）" class="headerlink" title="级联操作（cascade,简化操作）"></a>级联操作（cascade,简化操作）</h2><p>在一的一方或者多的一方的关联元素中，添加cascade属性，便可在数据进行更新或删除时简化操作。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	name属性：set集合名称</span></span><br><span class="line"><span class="comment">	column属性：外键名称</span></span><br><span class="line"><span class="comment">	class属性：多的一方的完整类名</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	cascade值</span></span><br><span class="line"><span class="comment">	update-save:级联保存更新</span></span><br><span class="line"><span class="comment">	delete:级联删除</span></span><br><span class="line"><span class="comment">	all:两者</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"linkMens"</span> <span class="attr">cascade</span>=<span class="string">"update-save"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"lkm_cust_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"LinkMan"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>不建议使用delete，太危险。</p>
<h2 id="关系维护（inverse-提高性能）"><a href="#关系维护（inverse-提高性能）" class="headerlink" title="关系维护（inverse,提高性能）"></a>关系维护（inverse,提高性能）</h2><p>在执行保存（瞬时转持久）时，两方都会维护关系，维护了两次，冗余。一的一方不用维护，只交给多的一方在插入时维护便可。</p>
<p>在一的一方或者多的一方的关联元素中，添加inverse属性，便可设置其是否维护关系。true时不维护，false（默认）时维护。多的一方不能放弃维护，因为外键字段就在多的一方。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"linkMens"</span> <span class="attr">inverse</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"lkm_cust_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"LinkMan"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当一的一方放弃维护时，则其关系集合中便不用再add成员，即维护关系的代码可以省略：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.getLinkMans().add(lm1);   <span class="comment">//省略</span></span><br></pre></td></tr></table></figure>
<h1 id="多对多关系"><a href="#多对多关系" class="headerlink" title="多对多关系"></a>多对多关系</h1><h2 id="在表中的表达"><a href="#在表中的表达" class="headerlink" title="在表中的表达"></a>在表中的表达</h2><p>使用<strong>中间表</strong>，至少两个外键列，分别引用两张表的主键</p>
<h2 id="在对象中的表达-1"><a href="#在对象中的表达-1" class="headerlink" title="在对象中的表达"></a>在对象中的表达</h2><p>两边都使用集合（Set）来表达拥有多个对方</p>
<h2 id="在orm元数据中的表达-1"><a href="#在orm元数据中的表达-1" class="headerlink" title="在orm元数据中的表达"></a>在orm元数据中的表达</h2><p>两边的orm元数据中都添加set元素</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	name:集合名</span></span><br><span class="line"><span class="comment">	table:中间表的名字</span></span><br><span class="line"><span class="comment">	key中的column:我方主键名</span></span><br><span class="line"><span class="comment">	class:对方类名</span></span><br><span class="line"><span class="comment">	many-to-many中的column:对方主键名</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"roles"</span> <span class="attr">table</span>=<span class="string">"sys_user_role"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"user_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">class</span>=<span class="string">"Role"</span> <span class="attr">column</span>=<span class="string">"role_ud"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><p>在多对多关系中，两方不可都维护关系，不然在中间表中会产生相同的主键导致错误，必须要有一方放弃关系维护——不写维护关系的代码或者inverse=true。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/01/自动装箱与拆箱、==与equals/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="h#">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="learningByDoing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/01/自动装箱与拆箱、==与equals/" itemprop="url">装箱拆箱、==与equals</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-01T00:00:00+08:00">2017-11-01</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Java基础/" itemprop="url" rel="index"><span itemprop="name">Java基础</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自动装箱</span></span><br><span class="line">Integer total = <span class="number">99</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//自定拆箱</span></span><br><span class="line"><span class="keyword">int</span> totalprim = total;</span><br></pre></td></tr></table></figure>
<h1 id="装箱"><a href="#装箱" class="headerlink" title="装箱"></a>装箱</h1><p>Integer total = 99;<br>执行上面那句代码的时候，系统为我们执行了：<br>Integer total = Integer.valueOf(99);</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title">valueOf</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  i &gt;= <span class="number">128</span> || i &lt; -<span class="number">128</span> ? <span class="keyword">new</span> Integer(i) : SMALL_VALUES[i + <span class="number">128</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>它会首先判断i的大小：如果i小于-128或者大于等于128，就创建一个Integer对象，否则执行SMALL_VALUES[i + 128]。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Integer i1 = <span class="number">100</span>;</span><br><span class="line">        Integer i2 = <span class="number">100</span>;</span><br><span class="line">        Integer i3 = <span class="number">200</span>;</span><br><span class="line">        Integer i4 = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println(i1==i2);  <span class="comment">//true</span></span><br><span class="line">        System.out.println(i3==i4);  <span class="comment">//false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1、i1和i2会进行自动装箱，执行了valueOf函数，它们的值在(-128,128]这个范围内，它们会拿到SMALL_VALUES数组里面的同一个对象SMALL_VALUES[228]，它们引用到了同一个Integer对象，所以它们肯定是相等的。</p>
<p>2、i3和i4也会进行自动装箱，执行了valueOf函数，它们的值大于128，所以会执行new Integer(200)，也就是说它们会分别创建两个不同的对象，所以它们肯定不等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Double i1 = <span class="number">100.0</span>;</span><br><span class="line">        Double i2 = <span class="number">100.0</span>;</span><br><span class="line">        Double i3 = <span class="number">200.0</span>;</span><br><span class="line">        Double i4 = <span class="number">200.0</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println(i1==i2); <span class="comment">//false</span></span><br><span class="line">        System.out.println(i3==i4); <span class="comment">//false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于Integer，在(-128,128]之间只有固定的256个值，所以为了避免多次创建对象，我们事先就创建好一个大小为256的Integer数组SMALL_VALUES，所以如果值在这个范围内，就可以直接返回我们事先创建好的对象就可以了。但是对于Double类型来说，我们就不能这样做，因为它在这个范围内个数是无限的。</p>
<p>所以在Double里面的做法很直接，就是直接创建一个对象，所以每次创建的对象都不一样。</p>
<p><strong>Integer派别：</strong>Integer、Short、Byte、Character、Long这几个类的valueOf方法的实现是类似的。<br><strong>Double派别</strong>：Double、Float的valueOf方法的实现是类似的。每次都返回不同的对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        Boolean i1 = false;</span><br><span class="line">        Boolean i2 = false;</span><br><span class="line">        Boolean i3 = true;</span><br><span class="line">        Boolean i4 = true;</span><br><span class="line"></span><br><span class="line">        System.out.println(i1==i2);//true</span><br><span class="line">        System.out.println(i3==i4);//true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到返回的都是true，也就是它们执行valueOf返回的都是相同的对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public static Boolean valueOf(boolean b) &#123;</span><br><span class="line">    return b ? Boolean.TRUE : Boolean.FALSE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到它并没有创建对象，因为在内部已经提前创建好两个对象，因为它只有两种情况，这样也是为了避免重复创建太多的对象。</p>
<h1 id="拆箱"><a href="#拆箱" class="headerlink" title="拆箱"></a>拆箱</h1><p>int totalprim = total;<br>执行上面那句代码的时候，系统为我们执行了：<br>int totalprim = total.intValue();</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Integer num1 = <span class="number">400</span>;  </span><br><span class="line"><span class="keyword">int</span> num2 = <span class="number">400</span>;  </span><br><span class="line">System.out.println(num1 == num2); <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p>说明num1 == num2进行了拆箱操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Integer num1 = <span class="number">100</span>;  </span><br><span class="line"><span class="keyword">int</span> num2 = <span class="number">100</span>;  </span><br><span class="line">System.out.println(num1.equals(num2));  <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p><strong>equals源码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (o <span class="keyword">instanceof</span> Integer) &amp;&amp; (((Integer) o).value == value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们指定equal比较的是内容本身，并且我们也可以看到equals的参数是一个Object对象，我们传入的是一个int类型，所以首先会进行装箱，然后比较，之所以返回true，是由于它比较的是对象里面的value值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Integer num1 = <span class="number">100</span>;  </span><br><span class="line"><span class="keyword">int</span> num2 = <span class="number">100</span>;  </span><br><span class="line">Long num3 = <span class="number">200l</span>;  </span><br><span class="line">System.out.println(num1 + num2);  <span class="comment">//200</span></span><br><span class="line">System.out.println(num3 == (num1 + num2));  <span class="comment">//true</span></span><br><span class="line">System.out.println(num3.equals(num1 + num2));  <span class="comment">//false</span></span><br></pre></td></tr></table></figure>
<p>1、当一个基础数据类型与封装类进行==、+、-、*、/运算时，会将封装类进行拆箱，对基础数据类型进行运算。 </p>
<p>当 “==”运算符的两个操作数都是 包装器类型的引用，则是比较指向的是否是同一个对象，而如果其中有一个操作数是表达式（即包含算术运算）则比较的是数值（即会触发自动拆箱的过程）。<br>2、对于num3.equals(num1 + num2)为false的原因很简单，我们还是根据代码实现来说明：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (o <span class="keyword">instanceof</span> Long) &amp;&amp; (((Long) o).value == value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>它必须满足两个条件才为true：<br>1、类型相同<br>2、内容相同<br>上面返回false的原因就是类型不同</p>
<p>通过上面的分析我们需要知道两点：<br>1、什么时候会引发装箱和拆箱<br>2、装箱操作会创建对象，频繁的装箱操作会消耗许多内存，影响性能，所以可以避免装箱的时候应该尽量避免。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/01/SSH整合/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="h#">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="learningByDoing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/01/SSH整合/" itemprop="url">SSH 整合</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-01T00:00:00+08:00">2017-11-01</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/JavaWeb/" itemprop="url" rel="index"><span itemprop="name">JavaWeb</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/JavaWeb/SSH框架/" itemprop="url" rel="index"><span itemprop="name">SSH框架</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="SSH整合"><a href="#SSH整合" class="headerlink" title="SSH整合"></a>SSH整合</h1><h2 id="整合理论"><a href="#整合理论" class="headerlink" title="整合理论"></a>整合理论</h2><ol>
<li>spring负责action</li>
<li>spring负责sessionFactory、session</li>
<li>spring负责aop事务</li>
</ol>
<h2 id="导包"><a href="#导包" class="headerlink" title="导包"></a>导包</h2><p>struts2-spring-plugin.jar一旦导入，那么struts2一旦启动就会去寻找spring容器，找不到则抛出异常。</p>
<h2 id="整合spring到web"><a href="#整合spring到web" class="headerlink" title="整合spring到web"></a>整合spring到web</h2><ol>
<li>主配置文件的创建与约束</li>
<li>在web.xml中配置ContextLoaderListener并指定配置文件位置让spring随项目启动而启动</li>
</ol>
<h2 id="整合struts2到web"><a href="#整合struts2到web" class="headerlink" title="整合struts2到web"></a>整合struts2到web</h2><ol>
<li>主配置文件的创建与约束</li>
<li>在web.xml中配置struts2的核心过滤器StrutsPrepareAndExecuteFilter</li>
</ol>
<h2 id="整合spring和struts2"><a href="#整合spring和struts2" class="headerlink" title="整合spring和struts2"></a>整合spring和struts2</h2><ol>
<li><p>配置action的bean元素</p>
<p><strong>注意：</strong>千万记得配置ACTION时它的scope属性要为prototype</p>
</li>
<li><p>配置struts2常量</p>
<ol>
<li><code>&lt;constant name=&quot;struts.objectFactory&quot; value=&quot;spring&quot;</code>将对象（ACTION）的创建交给spring容器</li>
<li><code>&lt;constant name=&quot;struts.objectFactory.spring.autoWire&quot; value=&quot;name&quot;</code>spring负责自动注入action中的依赖，不用额外配置，默认就已经配置了。按name属性来注入依赖。</li>
</ol>
</li>
<li><p>若struts2配置中action的class属性为完整类名，则struts2负责action的创建，spring负责action中属性的自动注入，属于半整合，不推荐使用</p>
</li>
<li><p>struts2配置中action的class属性为spring配置中对应的bean的name属性，这样就完全由spring管理action的生命周期，包括创建。但这样就要手动注入属性。推荐使用。</p>
</li>
</ol>
<h2 id="整合hibernate到Web"><a href="#整合hibernate到Web" class="headerlink" title="整合hibernate到Web"></a>整合hibernate到Web</h2><ol>
<li>书写orm元数据</li>
<li>主配置文件的创建与约束</li>
</ol>
<h2 id="整合spring和hibernate"><a href="#整合spring和hibernate" class="headerlink" title="整合spring和hibernate"></a>整合spring和hibernate</h2><ol>
<li><p>配置SessionFactory配置到spring容器中</p>
<p><code>&lt;bean name=&quot;sessionFactory class=&quot;org.springframework.orm.hibernate5.LocalSessionFactoryBean&quot;&gt;&lt;/bean&gt;</code></p>
</li>
<li><p>加载SessionFactory的配置，即Configuration</p>
<ol>
<li><p>仍然使用外部的hibernate.cfg.xml:<code>&lt;property name=&quot;configLocation&quot; value=&quot;classpath:hibernate.cfg.xml&quot;&gt;&lt;/property&gt;</code>不推荐</p>
</li>
<li><p>将原本hibernate.cfg.xml中的配置放到spring中加载：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate5.LocalSessionFactoryBean"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernateProperties"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql:///cst<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>WZhe941127<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">				</span><br><span class="line">				<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mappingDirectoryLocations"</span> <span class="attr">value</span>=<span class="string">"classpath:domain"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
<h2 id="spring整合c3p0连接池"><a href="#spring整合c3p0连接池" class="headerlink" title="spring整合c3p0连接池"></a>spring整合c3p0连接池</h2><ol>
<li>配置db.properties</li>
<li>引入连接池到spring</li>
<li>将连接池注入给SessionFactory</li>
</ol>
<h2 id="HibernateTemplate模板对象操作数据库"><a href="#HibernateTemplate模板对象操作数据库" class="headerlink" title="HibernateTemplate模板对象操作数据库"></a>HibernateTemplate模板对象操作数据库</h2><p>与jdbc模板相似，daoImpl继承HibernateDaoSupport。在方法中用到模板对象时就<code>getHibernateTemplate()</code></p>
<p>在配置daoImpl时，要注入sessionFactory，sessionFactory中已经注入了dataSource</p>
<h2 id="spring的aop事务"><a href="#spring的aop事务" class="headerlink" title="spring的aop事务"></a>spring的aop事务</h2><ol>
<li><p>配置核心事务管理器</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate5.HibernateTransactionManager"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sessionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置事务模板对象（可以没有？？）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"transactionTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.transaction.support.TransactionTemplate"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"transactionManager"</span> <span class="attr">ref</span>=<span class="string">"transactionManager"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置通知</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txadvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 八大常用方法通配符 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"save*"</span> <span class="attr">isolation</span>=<span class="string">"REPEATABLE_READ"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"persist*"</span> <span class="attr">isolation</span>=<span class="string">"REPEATABLE_READ"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"delete*"</span> <span class="attr">isolation</span>=<span class="string">"REPEATABLE_READ"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"remove*"</span> <span class="attr">isolation</span>=<span class="string">"REPEATABLE_READ"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"update*"</span> <span class="attr">isolation</span>=<span class="string">"REPEATABLE_READ"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"modify*"</span> <span class="attr">isolation</span>=<span class="string">"REPEATABLE_READ"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"get*"</span> <span class="attr">isolation</span>=<span class="string">"REPEATABLE_READ"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"find*"</span> <span class="attr">isolation</span>=<span class="string">"REPEATABLE_READ"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将通知织入目标对象</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* service.impl.*Service.Impl.*(..))"</span> <span class="attr">id</span>=<span class="string">"txpc"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txadvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"txpc"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="扩大session作用范围"><a href="#扩大session作用范围" class="headerlink" title="扩大session作用范围"></a>扩大session作用范围</h2><p>避免使用懒加载时出现NoSession问题，需要在web.xml中用Filter扩大其作用范围</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 字面意识就是使session在view层也保持打开 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>openSessionInView<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.orm.hibernate5.support.OpenSessionInViewFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>openSessionInView<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong>所有的过滤器都要保证放在struts2过滤器的前面，因为struts2过滤器不会放行。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/01/struts2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="h#">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="learningByDoing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/01/struts2/" itemprop="url">struts2</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-01T00:00:00+08:00">2017-11-01</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/JavaWeb/" itemprop="url" rel="index"><span itemprop="name">JavaWeb</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/JavaWeb/SSH框架/" itemprop="url" rel="index"><span itemprop="name">SSH框架</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="框架搭建"><a href="#框架搭建" class="headerlink" title="框架搭建"></a>框架搭建</h1><ol>
<li><p>导包</p>
</li>
<li><p>书写Action类</p>
</li>
<li><p>书写src/struts.xml</p>
</li>
<li><p>将struts核心过滤器配置到web.xml</p>
<p>filter-class为org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter</p>
</li>
</ol>
<h1 id="配置文件详解"><a href="#配置文件详解" class="headerlink" title="配置文件详解"></a>配置文件详解</h1><h2 id="核心配置（struts-xml）"><a href="#核心配置（struts-xml）" class="headerlink" title="核心配置（struts.xml）"></a>核心配置（struts.xml）</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		package:封装配置action，不同于java中的package</span></span><br><span class="line"><span class="comment">			name:包名，起标识作用，不可与其它包名重复，给Action划分模块</span></span><br><span class="line"><span class="comment">			namespace:给Action的访问路径中定义一个命名空间，方便在路径中划分模块，如/hello</span></span><br><span class="line"><span class="comment">			extends:继承一个指定包，必须继承struts-default包</span></span><br><span class="line"><span class="comment">			abstract:包是否为抽象的，标识作用，说明该包专门用来继承，值为true或false</span></span><br><span class="line"><span class="comment">		action:</span></span><br><span class="line"><span class="comment">			name:决定了Action访问资源名，如/hello/HelloAction的HelloAction</span></span><br><span class="line"><span class="comment">			class:Action类的完整类名</span></span><br><span class="line"><span class="comment">			method:指定调用Action中的哪个方法来处理请求</span></span><br><span class="line"><span class="comment">		result:结果配置</span></span><br><span class="line"><span class="comment">			name:标识结果处理的名称，与action的method的返回值对应。</span></span><br><span class="line"><span class="comment">			type:指定调用哪个result类来处理结果，默认使用转发dispatcher</span></span><br><span class="line"><span class="comment">			标签体:相对路径</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"hello"</span> <span class="attr">namespace</span>=<span class="string">"/hello"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"HelloAction"</span> <span class="attr">class</span>=<span class="string">"web.HelloAction"</span> <span class="attr">method</span>=<span class="string">"hello"</span>&gt;</span></span><br><span class="line">      		<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span> <span class="attr">type</span>=<span class="string">"dispatcher"</span>&gt;</span>/hello.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="常量配置"><a href="#常量配置" class="headerlink" title="常量配置"></a>常量配置</h2><p>默认的常量配置位置：</p>
<p>struts-core.jar下的org.apache.struts2的包中有default.properties。</p>
<h3 id="修改常量配置"><a href="#修改常量配置" class="headerlink" title="修改常量配置"></a>修改常量配置</h3><ol>
<li>在src下创建struts.property，将default.properties中的属性在上面重写</li>
<li>在struts.xml中添加constant标签，属性为name与value</li>
<li>在web.xml中添加context-param标签，子标签为param-name与param-value</li>
</ol>
<p>一般都使用第二种，此也为加载顺序，后面的可覆盖前面的。</p>
<h1 id="配置进阶"><a href="#配置进阶" class="headerlink" title="配置进阶"></a>配置进阶</h1><h2 id="动态方法调用"><a href="#动态方法调用" class="headerlink" title="动态方法调用"></a>动态方法调用</h2><h3 id="方式1：配置动态方法调用的常量（了解）"><a href="#方式1：配置动态方法调用的常量（了解）" class="headerlink" title="方式1：配置动态方法调用的常量（了解）"></a>方式1：配置动态方法调用的常量（了解）</h3><p>在主配置文件中添加：</p>
<constant name="struts.enable.DynamicMethodInvocation" value="true"></constant>

<p>默认是关闭的</p>
<p>在浏览器url的最后加上!方法名：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/SSH/hello/HelloAction!add</span><br></pre></td></tr></table></figure>
<h3 id="方式2：通配符方式"><a href="#方式2：通配符方式" class="headerlink" title="方式2：通配符方式"></a>方式2：通配符方式</h3><p>action标签改写如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"HelloAction_*"</span> <span class="attr">class</span>=<span class="string">"web.HelloAction"</span> <span class="attr">method</span>=<span class="string">"&#123;1&#125;"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="默认配置"><a href="#默认配置" class="headerlink" title="默认配置"></a>默认配置</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"hello"</span> <span class="attr">namespace</span>=<span class="string">"/hello"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">default-action-ref</span> <span class="attr">name</span>=<span class="string">"HelloAction"</span>&gt;</span><span class="tag">&lt;/<span class="name">default-action-ref</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"HelloAction"</span> <span class="attr">class</span>=<span class="string">"web.HelloAction"</span> <span class="attr">method</span>=<span class="string">"hello"</span>&gt;</span></span><br><span class="line">      		<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span> <span class="attr">type</span>=<span class="string">"dispatcher"</span>&gt;</span>/hello.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>action的method的默认值：execute</p>
<p>action的class的默认值：struts-default中已经有一个默认的class</p>
<p>result的name的默认值：success</p>
<p>result的type的默认值：dispatcher</p>
<p>标签default-action-ref的作用为：若找不到包下的action,则会默认找HelloAction</p>
<h1 id="Action类的书写方式"><a href="#Action类的书写方式" class="headerlink" title="Action类的书写方式"></a>Action类的书写方式</h1><ol>
<li>直接创建一个简单类</li>
<li>实现一个接口类Action，接口类Action预置了一些字符串，可在返回结果时使用</li>
<li>继承ActionSupport类(推荐)，帮我们实现了多个接口</li>
</ol>
<h1 id="结果跳转方式（result-type）"><a href="#结果跳转方式（result-type）" class="headerlink" title="结果跳转方式（result-type）"></a>结果跳转方式（result-type）</h1><ol>
<li><p>转发（dispatcher）</p>
</li>
<li><p>重定向（redirect）</p>
</li>
<li><p>转发到Action（chain）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span> <span class="attr">type</span>=<span class="string">"chain"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"actionName"</span>&gt;</span>Demo1Action<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"namespace"</span>&gt;</span>/<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>重定向到Action</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span> <span class="attr">type</span>=<span class="string">"redirectAction"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"actionName"</span>&gt;</span>Demo1Action<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"namespace"</span>&gt;</span>/<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>$&#123;name&#125;<span class="tag">&lt;/<span class="name">param</span>&gt;</span> </span><br><span class="line">	这里只要name不认识，它就会作为URL上的参数，附在Demo1Action的后面</span><br><span class="line">	如http://localhost:8080/SSH/Demo1Action?name=tom</span><br><span class="line">	这里用了OGNL表达式来动态取值</span><br><span class="line"><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h1><p>在主配置文件中，给相关的package加上global-exception-mappings标签，在其中设定异常跳转页面与action中的某个跳转页面相一致，如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">global-exception-mappings</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">exception-mapping</span> <span class="attr">result</span>=<span class="string">"error"</span> <span class="attr">exception</span>=<span class="string">"java.lang.RuntimeException"</span>&gt;</span><span class="tag">&lt;/<span class="name">exception-mapping</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;/<span class="name">global-exception-mappings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"UserAction_*"</span> <span class="attr">class</span>=<span class="string">"web.action.UserAction"</span> <span class="attr">method</span>=<span class="string">"&#123;1&#125;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"toIndex"</span> <span class="attr">type</span>=<span class="string">"redirect"</span>&gt;</span>/index.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"error"</span> <span class="attr">type</span>=<span class="string">"dispatcher"</span>&gt;</span>/login.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong>global-exception-mappings标签要在action标签的前面</p>
<h1 id="Action访问Servlet的API"><a href="#Action访问Servlet的API" class="headerlink" title="Action访问Servlet的API"></a>Action访问Servlet的API</h1><h2 id="ActionContext"><a href="#ActionContext" class="headerlink" title="ActionContext"></a>ActionContext</h2><p>ActionContext本身是一个map。源码将ActionContext对象创建好后，会将ActionContext与当前线程绑定。要获得ActionContext只需要从ThreadLocal中获取即可，即getContext()。</p>
<p>通过其可以访问：</p>
<ol>
<li>原生request        HttpServletRequest<ol>
<li>原生response    HttpServletResponse<ol>
<li>原生SessionHttp        Session</li>
<li>原生ServletContextServlet        Context</li>
<li>request域       map</li>
<li>session域        map</li>
<li>application域       map</li>
<li>param参数         map</li>
<li>attr域            map 三域合一，以小优先</li>
<li>ValueStack          值栈 </li>
</ol>
</li>
</ol>
</li>
</ol>
<p>生命周期：每次请求时都会创建一个与请求对应的ActionContext，请求处理完ActionContext销毁。</p>
<h3 id="相关API"><a href="#相关API" class="headerlink" title="相关API"></a>相关API</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ActionContext.getContext().getSession();  <span class="comment">//session域</span></span><br><span class="line">ActionContext.getContext().getApplication();  <span class="comment">//application域</span></span><br><span class="line"><span class="comment">//struts2不推荐使用request域，因为ActionContext生命周期与request相同，且为map，故可将attr直接放入到ActionContext中,取还是一样取</span></span><br><span class="line">ActionContext.getContext().put(<span class="string">"name"</span>,<span class="string">"h#"</span>);</span><br><span class="line">ActionContext.getContext().get(<span class="string">"request"</span>)	<span class="comment">//request域</span></span><br><span class="line">ActionContext.getContext().getParameters()	<span class="comment">//parameterMap</span></span><br></pre></td></tr></table></figure>
<h2 id="ServletActionContext"><a href="#ServletActionContext" class="headerlink" title="ServletActionContext"></a>ServletActionContext</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//本质上还是ActionContext获得对象，不推荐使用，因为框架本来就是为了不使用Servlet</span></span><br><span class="line">ServletActionContext.getRequest();	<span class="comment">//原生Request</span></span><br><span class="line">ServletActionContext.getResponse();	<span class="comment">//原生Response</span></span><br><span class="line">ServletActionContext.getServletContext();	<span class="comment">//原生ServletContext</span></span><br><span class="line">ServletActionContext.getRequest().getSession();	<span class="comment">//原生session</span></span><br></pre></td></tr></table></figure>
<h1 id="获得参数的方式-皆可"><a href="#获得参数的方式-皆可" class="headerlink" title="获得参数的方式(皆可)"></a>获得参数的方式(皆可)</h1><h2 id="单个类型参数的封装"><a href="#单个类型参数的封装" class="headerlink" title="单个类型参数的封装"></a>单个类型参数的封装</h2><h3 id="方式一（属性驱动）"><a href="#方式一（属性驱动）" class="headerlink" title="方式一（属性驱动）"></a>方式一（属性驱动）</h3><p>在Action类下准备与网页参数名称相同的<strong>属性</strong>，如<code>private String name；赋予get与set</code>。struts2支持自动类型转换，只能转换八大基本数据类型及其包装类还有Date。然后再手动封装到对象中。</p>
<p>每次发出一个请求都会创建新的Action实例对象，因此其对成员变量name的访问是线程安全的。</p>
<h3 id="方式二（对象驱动）"><a href="#方式二（对象驱动）" class="headerlink" title="方式二（对象驱动）"></a>方式二（对象驱动）</h3><p>在Action类下准备一个<strong>属性</strong>对象，如<code>private User user</code>。然后在jsp上将相关参数的名称修改为.xx。如：<code>&lt;input type=&quot;text&quot; name=&quot;user.name&quot; /&gt;</code>。这样提交之后，就会自动将参数封装到user对象中。</p>
<h3 id="方式三（模型驱动）"><a href="#方式三（模型驱动）" class="headerlink" title="方式三（模型驱动）"></a>方式三（模型驱动）</h3><p>实现模型驱动的<strong>原理</strong>实际上是在赋值之前（params拦截器作用之前），将接受参数的对象压入ValueStack的栈顶即可。</p>
<p>第一种是利用ModelDriven拦截器。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> <span class="keyword">implements</span> <span class="title">ModelDriven</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> User user = <span class="keyword">new</span> User(); <span class="comment">//准备成员变量</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    syso(user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> User <span class="title">getModel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>页面参数名称不用变，会自动封装到user中。</p>
<p>还有一种做法是在prepare拦截器中操作。原理相同</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> <span class="keyword">implements</span> <span class="title">Preparable</span> </span>&#123;</span><br><span class="line"> 	<span class="keyword">private</span> Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line"> 	<span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	System.out.println(customer);</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br><span class="line"> 	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	ValueStack vs = ActionContext.getContext().getValueStack();  <span class="comment">//获得值栈</span></span><br><span class="line">	vs.push(customer);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="集合类型参数的封装"><a href="#集合类型参数的封装" class="headerlink" title="集合类型参数的封装"></a>集合类型参数的封装</h2><h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><p>Action类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> List&lt;String&gt; list; <span class="comment">//准备属性list</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    syso(user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  getList、setList</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>页面设置：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"list"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"list[1]"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"list[5]"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样就会自动将参数封装到list中，此时list共有六个元素，三个为null</p>
<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><p>Action类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Map&lt;String, String&gt; map; <span class="comment">//准备属性list</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    syso(user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  getMap、setMap</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>页面设置</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"map['1']"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"map['2']"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"map['3']"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样提交的参数就会以map的值的形式封装。</p>
<h1 id="OGNL"><a href="#OGNL" class="headerlink" title="OGNL"></a>OGNL</h1><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>OGNLContext分Root与Context两部分。任何对象都可作为Root，Context是一个Map。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">User rootUser = <span class="keyword">new</span> User(<span class="string">"a"</span>,<span class="number">1</span>);  <span class="comment">//准备root</span></span><br><span class="line">Map&lt;String, User&gt; context = HashMap&lt;String, User&gt;();   <span class="comment">//准备context</span></span><br><span class="line">context.put(<span class="string">"user1"</span>, <span class="keyword">new</span> User(<span class="string">"b"</span>,<span class="number">2</span>));</span><br><span class="line">context.put(<span class="string">"user2"</span>, <span class="keyword">new</span> User(<span class="string">"c"</span>,<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建OGNLContext</span></span><br><span class="line">OgnlContext oc = <span class="keyword">new</span> OgnlContext();</span><br><span class="line">oc.setRoot(rootUser);</span><br><span class="line">oc.setValues(context);</span><br><span class="line"></span><br><span class="line"><span class="comment">//书写OGNL表达式</span></span><br><span class="line">Ognl.getValue(expression, oc, oc.getRoot());</span><br></pre></td></tr></table></figure>
<h2 id="OGNL表达式语法"><a href="#OGNL表达式语法" class="headerlink" title="OGNL表达式语法"></a>OGNL表达式语法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//取出root中user对象的name属性</span></span><br><span class="line">Ognl.getValue(<span class="string">"name"</span>, oc, oc.getRoot());</span><br><span class="line"><span class="comment">//取出root中user对象的age属性</span></span><br><span class="line">Ognl.getValue(<span class="string">"age"</span>, oc, oc.getRoot());</span><br><span class="line"></span><br><span class="line"><span class="comment">//取出context中user1对象的name属性</span></span><br><span class="line">Ognl.getValue(<span class="string">"#user1.name"</span>, oc, oc.getRoot());</span><br><span class="line"><span class="comment">//取出context中user2对象的age属性</span></span><br><span class="line">Ognl.getValue(<span class="string">"#user2.age"</span>, oc, oc.getRoot());</span><br><span class="line"></span><br><span class="line"><span class="comment">//给root中user对象的name属性赋值</span></span><br><span class="line">Ognl.getValue(<span class="string">"name='d'"</span>, oc, oc.getRoot());</span><br><span class="line"><span class="comment">//给context中user1对象的name属性赋值</span></span><br><span class="line">Ognl.getValue(<span class="string">"#user1.name='e'"</span>, oc, oc.getRoot());</span><br><span class="line"><span class="comment">//先赋值后取值，根据最后一个表达式得返回值</span></span><br><span class="line">String name  = (String)Ognl.getValue(<span class="string">"name='d', name"</span>, oc, oc.getRoot());</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用root中user对象的方法</span></span><br><span class="line">String name  = (String)Ognl.getValue(<span class="string">"getName()"</span>, oc, oc.getRoot());</span><br><span class="line"><span class="comment">//调用context中user1对象的方法</span></span><br><span class="line">String name  = (String)Ognl.getValue(<span class="string">"#user1.setName('f'), #user1.getName()"</span>, oc, oc.getRoot());</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用某个类的静态方法/静态属性</span></span><br><span class="line">String result  = (String)Ognl.getValue(<span class="string">"@qualifiedName@methodName()"</span>, oc, oc.getRoot());</span><br><span class="line">Double pi  = (Double)Ognl.getValue(<span class="string">"@java.lang.math@PI"</span>, oc, oc.getRoot());</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建list对象</span></span><br><span class="line">Integer size = (Integer)Ognl.getValue(<span class="string">"&#123;'a','b','c'&#125;.size()"</span>, oc, oc.getRoot());</span><br><span class="line"><span class="comment">//创建map对象</span></span><br><span class="line">Integer size = (Integer)Ognl.getValue(<span class="string">"#&#123;'a':1,'b':2, 'c':'string'&#125;.size()"</span>, oc, oc.getRoot());</span><br></pre></td></tr></table></figure>
<h2 id="OGNL与Struts2结合"><a href="#OGNL与Struts2结合" class="headerlink" title="OGNL与Struts2结合"></a>OGNL与Struts2结合</h2><p>struts2中的OgnlContext就是ValueStack。对应的Root是一个栈Stack，对应的Context就是ActionContext。而栈中默认放的是当前访问的Action。</p>
<p> 在相应jsp中导入标签<code>&lt;%@ taglib prefix=&quot;s&quot; uri=&quot;/struts-tags&quot; %&gt;</code>，再生成标签<code>&lt;s:debug&gt;&lt;/s:debug&gt;</code>，就可在页面中可视化ValueStack。</p>
<p>request.getAttribute(key)的查找顺序为：</p>
<ol>
<li>原生request域</li>
<li>ValueStack的Root栈部分</li>
<li>ValueStack的Context部分</li>
</ol>
<h3 id="结合体现1：参数赋值"><a href="#结合体现1：参数赋值" class="headerlink" title="结合体现1：参数赋值"></a>结合体现1：参数赋值</h3><h3 id="结合体现2：主配置文件中重定向参数的赋值"><a href="#结合体现2：主配置文件中重定向参数的赋值" class="headerlink" title="结合体现2：主配置文件中重定向参数的赋值"></a>结合体现2：主配置文件中重定向参数的赋值</h3><h3 id="结合体现3：struts2标签"><a href="#结合体现3：struts2标签" class="headerlink" title="结合体现3：struts2标签"></a>结合体现3：struts2标签</h3><h1 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h1><h2 id="创建方式"><a href="#创建方式" class="headerlink" title="创建方式"></a>创建方式</h2><ol>
<li>实现Interceptor接口</li>
<li>继承AbstractInterceptor，AbstractInterceptor实现了Interceptor接口，并空实现了其中的init()与destory()方法</li>
<li>继承MethodFilterInterceptor，可以定制拦截器拦截的方法与不拦截的方法</li>
</ol>
<h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><p>随项目的启动而创建，随项目的关闭而销毁</p>
<h2 id="相关API-1"><a href="#相关API-1" class="headerlink" title="相关API"></a>相关API</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="string">"before"</span>);	<span class="comment">//前处理</span></span><br><span class="line">String result = invocation.invoke();  <span class="comment">//放行</span></span><br><span class="line">System.out.println(<span class="string">"after"</span>);	<span class="comment">//后处理</span></span><br><span class="line"><span class="keyword">return</span> result;	<span class="comment">//若不放行，则没有invoke，不执行后续的拦截器以及Action并直接转移到一个结果页面</span></span><br></pre></td></tr></table></figure>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><ol>
<li>注册拦截器</li>
<li>注册拦截器栈</li>
<li>指定默认拦截器栈</li>
<li>定义全局结果集：拦截器在拦截之后的return， 会作用于每个Action。若在访问某个Action时，它没有相应的result结果，则会发生错误。为了简化代码（不用在每个Action中设定result），可以设定一个全局结果集。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"demo"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">    			<span class="comment">&lt;!-- 注册拦截器 --&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"myInterceptor"</span> <span class="attr">class</span>=<span class="string">"web.interceptor.MyInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line">    			<span class="comment">&lt;!-- 注册拦截器栈 --&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"myStack"</span>&gt;</span></span><br><span class="line">    				<span class="comment">&lt;!-- 先引入自己的拦截器 --&gt;</span></span><br><span class="line">    				<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"myInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">    				<span class="comment">&lt;!-- 再引入默认的二十个拦截器 --&gt;</span></span><br><span class="line">    				<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;/<span class="name">interceptor-stack</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br><span class="line">    		<span class="comment">&lt;!-- 在整个包中指定默认拦截器栈 --&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">default-interceptor-ref</span> <span class="attr">name</span>=<span class="string">"myStack"</span>&gt;</span><span class="tag">&lt;/<span class="name">default-interceptor-ref</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 在整个包中定义全局结果集 --&gt;</span></span><br><span class="line">  			<span class="tag">&lt;<span class="name">global-results</span>&gt;</span>								<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"toLogin"</span> <span class="attr">type</span>=<span class="string">"redirect"</span>&gt;</span>/login.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">global-results</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"DemoAction1_*"</span> <span class="attr">class</span>=<span class="string">"demo.DemoAction1"</span> <span class="attr">method</span>=<span class="string">"&#123;1&#125;"</span>&gt;</span></span><br><span class="line">	    		<span class="comment">&lt;!-- 在指定action中指定拦截器栈 --&gt;</span></span><br><span class="line">	    		<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"myStack"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/index.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="（不）拦截Action的指定方法"><a href="#（不）拦截Action的指定方法" class="headerlink" title="（不）拦截Action的指定方法"></a>（不）拦截Action的指定方法</h2><p>在引入的拦截器（栈）下面添加子标签<param></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"myInterceptor"</span>&gt;</span></span><br><span class="line">    					<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"excludeMethods"</span>&gt;</span>find<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    					<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"includeMethods"</span>&gt;</span>add<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    				<span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>若只有excludeMethods，则其它默认都include。includeMethods同理。</p>
<h2 id="定义全局结果集"><a href="#定义全局结果集" class="headerlink" title="定义全局结果集"></a>定义全局结果集</h2><p>拦截器在拦截之后的return， 会作用于每个Action。若在访问某个Action时，它没有相应的result结果，则会发生错误。为了简化代码（不用在每个Action中设定result），可以设定一个全局结果集。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">global-results</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"toLogin"</span> <span class="attr">type</span>=<span class="string">"redirect"</span>&gt;</span>/login.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">global-results</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="struts2标签"><a href="#struts2标签" class="headerlink" title="struts2标签"></a>struts2标签</h1><h2 id="通用标签"><a href="#通用标签" class="headerlink" title="通用标签"></a>通用标签</h2><ol>
<li>iterator</li>
<li>if</li>
<li>elseif</li>
<li>else</li>
<li>property</li>
</ol>
<h2 id="表单标签-没学"><a href="#表单标签-没学" class="headerlink" title="表单标签(没学)"></a>表单标签(没学)</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/09/多重继承/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="h#">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="learningByDoing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/09/多重继承/" itemprop="url">多重继承</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-09T00:00:00+08:00">2017-10-09</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Python基础/" itemprop="url" rel="index"><span itemprop="name">Python基础</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="MixIn"><a href="#MixIn" class="headerlink" title="MixIn"></a>MixIn</h1><p>在设计类的继承关系时，通常，主线都是单一继承下来的，例如，Ostrich继承自Bird。但是，如果需要“混入”额外的功能，通过多重继承就可以实现。</p>
<pre><code>class Dog(Mammal, RunnableMixIn, CarnivorousMixIn):
    pass
</code></pre><p>Python自带的很多库也使用了MixIn。举个例子，Python自带了TCPServer和UDPServer这两类网络服务，而要同时服务多个用户就必须使用多进程或多线程模型，这两种模型由ForkingMixIn和ThreadingMixIn提供。通过组合，我们就可以创造出合适的服务来。</p>
<p>比如，编写一个多进程模式的TCP服务，定义如下：</p>
<pre><code>class MyTCPServer(TCPServer, ForkingMixIn):
    pass
</code></pre><p>由于Python允许使用多重继承，因此，MixIn就是一种常见的设计。</p>
<p>只允许单一继承的语言（如Java）不能使用MixIn的设计。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="h#" />
            
              <p class="site-author-name" itemprop="name">h#</p>
              <p class="site-description motion-element" itemprop="description">所学即所得</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">32</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">h#</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Gemini</a> v6.0.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.0.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.0.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.3"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

</body>
</html>
